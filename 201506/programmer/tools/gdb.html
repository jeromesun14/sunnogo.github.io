<!DOCTYPE html>





<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.8.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: ''
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="记录GDB使用过的方法。">
<meta name="keywords" content="gdb,调试,Debug,Linux,调用栈,变量,调用,函数,backtrace,多线程,死锁,设置,断点,watch,入参,局部变量,thread,local,内存,查看,线程">
<meta property="og:type" content="article">
<meta property="og:title" content="GDB使用记录">
<meta property="og:url" content="http://sunyongfeng.com/201506/programmer/tools/gdb.html">
<meta property="og:site_name" content="孙勇峰的部落格">
<meta property="og:description" content="记录GDB使用过的方法。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-04-17T09:58:07.084Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GDB使用记录">
<meta name="twitter:description" content="记录GDB使用过的方法。">
  <link rel="canonical" href="http://sunyongfeng.com/201506/programmer/tools/gdb">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>GDB使用记录 | 孙勇峰的部落格</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?20ef80920f0a54cb0bbdbe9ba6c4f83f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">孙勇峰的部落格</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Keep it simple, stupid</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">
      
    

    <a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>Commonweal 404</a>

  </li>
        <li class="menu-item menu-item-search">
          <a href="javascript:;" class="popup-trigger">
          
            <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
    

    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>

</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sunyongfeng.com/201506/programmer/tools/gdb.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sunnogo">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/default_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="孙勇峰的部落格">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">GDB使用记录

              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2015-06-17 20:40:18" itemprop="dateCreated datePublished" datetime="2015-06-17T20:40:18+08:00">2015-06-17</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-17 17:58:07" itemprop="dateModified" datetime="2019-04-17T17:58:07+08:00">2019-04-17</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programmer/" itemprop="url" rel="index"><span itemprop="name">programmer</span></a></span>

                
                
              
            </span>
          

          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">Comments: </span>
    
  
    <a href="/201506/programmer/tools/gdb.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="201506/programmer/tools/gdb.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>
            <div class="post-description">记录GDB使用过的方法。</div>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>GDB，GNU Debugger，<a href="http://en.wikipedia.org/wiki/Gdb#Features" target="_blank" rel="noopener">特性</a>如下：</p>
<ul>
<li>GDB具备各种调试功效，可对计算机程序的运行进行追踪、警告。使用者可以监控及修改程序内部变量的值，甚至可在程序的正常运行之外调用函数。</li>
<li>GDB支持多数处理器架构</li>
<li>持续开发中</li>
<li>支持远程调试</li>
<li>支持内核调试，KGDB</li>
</ul>
<a id="more"></a>
<p>从事嵌入式软件开发两年来，主要在以下几方面使用GDB：</p>
<ol>
<li>查看、修改运行时变量；</li>
<li>多线程调试，查看当前线程运行状态（以确定当前线程是不是因为等锁等原因挂起）；</li>
<li>查看<a href="http://zh.wikipedia.org/zh-cn/coredump" target="_blank" rel="noopener">coredump</a>文件；</li>
<li>碰到难缠的内存非法改写问题，用GDB的断点、物理watch功能查看内存变化以定位改写者；</li>
</ol>
<blockquote>
<p>引用公司一个技术牛人的话：<em>在大型的项目中，使用GDB的单步调试、软件watch是不现实的，因为会运行得实在太慢。</em></p>
</blockquote>
<p>命令小记：  </p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">linux</span>提示符</span><br><span class="line"><span class="number">1</span>. GDB进入正在运行的进程</span><br><span class="line">    gdb 可执行文件 core文件 </span><br><span class="line">    gdb -p pid</span><br><span class="line">    </span><br><span class="line"><span class="symbol">GDB</span>提示符</span><br><span class="line"><span class="number">1</span>. 查看调用栈信息</span><br><span class="line">    <span class="keyword">bt </span>/ <span class="keyword">backtrace </span>/ <span class="keyword">bt </span>full</span><br><span class="line">    frame n</span><br><span class="line">    <span class="meta">info</span> locals</span><br><span class="line">    <span class="meta">info</span> args</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 查看、设置变量</span><br><span class="line">    p 变量</span><br><span class="line">    p 变量 = 新值</span><br><span class="line">    set 变量 = 新值</span><br><span class="line">    </span><br><span class="line"><span class="number">3</span>. 查看内存</span><br><span class="line">    x/&lt;n/f/u&gt; &lt;<span class="keyword">addr&gt;</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">4. </span>线程调试</span><br><span class="line">    <span class="meta">info</span> thread</span><br><span class="line">    thread n</span><br><span class="line">    thread apply all <span class="keyword">bt </span>full</span><br></pre></td></tr></table></figure>
<h2 id="启动GDB"><a href="#启动GDB" class="headerlink" title="启动GDB"></a>启动GDB</h2><h3 id="GCC选项"><a href="#GCC选项" class="headerlink" title="GCC选项"></a>GCC选项</h3><p>想用GDB调试，则在GCC编译的时候要加上<em>-g</em>选项。</p>
<h3 id="启动GDB-1"><a href="#启动GDB-1" class="headerlink" title="启动GDB"></a>启动GDB</h3><p>启动GDB的方法主要有以下几种：</p>
<ul>
<li><code>gdb</code></li>
<li><code>gdb executable_file</code></li>
<li><code>gdb executable_file corefile</code>：查看coredump文件信息，定位coredump产生原因、触发源。</li>
<li><code>gdb attach pid</code>：调度运行时的进程或线程，同<code>gdb -p pid</code>。</li>
</ul>
<h3 id="善用help"><a href="#善用help" class="headerlink" title="善用help"></a>善用help</h3><p>在GDB提示符下输入<code>help</code>或<code>help 命令</code>，能够查看命令的帮助说明。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(gdb) help</span><br><span class="line">List of classes of commands:</span><br><span class="line"></span><br><span class="line">aliases -- Aliases of other commands</span><br><span class="line">breakpoints -- Making program stop at certain points</span><br><span class="line">data -- Examining data</span><br><span class="line">files -- Specifying <span class="keyword">and</span> examining files</span><br><span class="line">internals -- Maintenance commands</span><br><span class="line">obscure -- Obscure features</span><br><span class="line">running -- Running the program</span><br><span class="line">stack -- Examining the stack</span><br><span class="line">status -- Status inquiries</span><br><span class="line">support -- Support facilities</span><br><span class="line">tracepoints -- Tracing of program execution without stopping the program</span><br><span class="line">user-defined -- User-defined commands</span><br><span class="line"></span><br><span class="line">Type <span class="string">"help"</span> followed by a class name <span class="keyword">for</span> a list of commands <span class="keyword">in</span> that class.</span><br><span class="line">Type <span class="string">"help all"</span> <span class="keyword">for</span> the list of all commands.</span><br><span class="line">Type <span class="string">"help"</span> followed by command name <span class="keyword">for</span> full documentation.</span><br><span class="line">Type <span class="string">"apropos word"</span> <span class="keyword">to</span> search <span class="keyword">for</span> commands related <span class="keyword">to</span> <span class="string">"word"</span>.</span><br><span class="line">Command name abbreviations are allowed <span class="keyword">if</span> unambiguous.</span><br></pre></td></tr></table></figure>
<h2 id="查看调用栈"><a href="#查看调用栈" class="headerlink" title="查看调用栈"></a>查看调用栈</h2><p>写一个简单的例子（仅为样例，并不严谨）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> member_a;</span><br><span class="line">    <span class="keyword">int</span> member_b;</span><br><span class="line">&#125; <span class="keyword">test_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> g_int;</span><br><span class="line"><span class="keyword">bool</span> g_bool;</span><br><span class="line"><span class="keyword">char</span> *g_str[] = &#123;</span><br><span class="line">    <span class="string">"Hello, GDB!"</span>,</span><br><span class="line">    <span class="string">"It's funny."</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">stay_here</span><span class="params">(<span class="keyword">int</span> arg, <span class="keyword">test_t</span> *test)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> local;</span><br><span class="line"></span><br><span class="line">    local = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    	local++;</span><br><span class="line">	    <span class="keyword">if</span> (local % <span class="number">200</span> == <span class="number">0</span>) &#123;</span><br><span class="line">	        local = <span class="number">0</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	    sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thread_process</span><span class="params">(<span class="keyword">void</span> *arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> in;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">    in = (<span class="keyword">int</span>)arg;</span><br><span class="line">    (<span class="keyword">void</span>)<span class="built_in">snprintf</span>(name, <span class="number">64</span>, <span class="string">"test-%d"</span>, in + <span class="number">1</span>);</span><br><span class="line">    prctl(PR_SET_NAME, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)name);  <span class="comment">/* set thread name */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">	    sleep(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create_thread</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, rv;</span><br><span class="line">    <span class="keyword">pthread_t</span> tid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    	rv = pthread_create(&amp;tid, <span class="literal">NULL</span>, thread_process, (<span class="keyword">void</span> *)i);</span><br><span class="line">	    assert(rv == <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> local;</span><br><span class="line">    <span class="keyword">test_t</span> test;</span><br><span class="line"></span><br><span class="line">    local = <span class="number">999</span>;</span><br><span class="line">    test.member_a = <span class="number">10</span>;</span><br><span class="line">    test.member_b = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">    create_thread();</span><br><span class="line">    stay_here(local, &amp;test);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译并运行起来，注意gcc的<em>-g</em>选项，这里使用<em>&amp;</em>让程序运行到后台，<em>[1] 8043</em>指刚刚这个程序运行时的进程号，也可用<code>ps</code>命令查看。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sunnogo<span class="variable">@a3e420</span><span class="symbol">:~/test/gdb</span><span class="variable">$ </span>gcc -o prt_mod_var prt_mod_var.c -g -Wall -lpthread</span><br><span class="line">sunnogo<span class="variable">@a3e420</span><span class="symbol">:~/test/gdb</span><span class="variable">$ </span></span><br><span class="line">sunnogo<span class="variable">@a3e420</span><span class="symbol">:~/test/gdb</span><span class="variable">$ </span>ls</span><br><span class="line">prt_mod_var  prt_mod_var.c</span><br><span class="line">sunnogo<span class="variable">@a3e420</span><span class="symbol">:~/test/gdb</span><span class="variable">$ </span>./prt_mod_var &amp;</span><br><span class="line">[<span class="number">1</span>] <span class="number">8043</span></span><br><span class="line">sunnogo<span class="variable">@a3e420</span><span class="symbol">:~/test/gdb</span><span class="variable">$ </span></span><br><span class="line">sunnogo<span class="variable">@a3e420</span><span class="symbol">:~/test/gdb</span><span class="variable">$ </span>ps -e | grep prt_mod_var</span><br><span class="line"> <span class="number">8043</span> pts/<span class="number">1</span>    <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span> prt_mod_var</span><br></pre></td></tr></table></figure>
<p>接下来使用<code>gdb -p 8043</code>连入正在运行的进程中。还不明白为什么我的计算机中要求使用root权限才能让GDB attach到对应进程。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sunnogo@a3e420:~/test/gdb$ gdb -p <span class="number">8043</span></span><br><span class="line">GNU gdb (GDB) <span class="number">7.5</span>-ubuntu</span><br><span class="line">Copyright (C) <span class="number">2012</span> Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL <span class="built_in">version</span> <span class="number">3</span> <span class="keyword">or</span> later &lt;<span class="keyword">http</span>://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free <span class="built_in">to</span> change <span class="keyword">and</span> redistribute <span class="keyword">it</span>.</span><br><span class="line">There is NO WARRANTY, <span class="built_in">to</span> <span class="keyword">the</span> extent permitted <span class="keyword">by</span> law.  Type <span class="string">"show copying"</span></span><br><span class="line"><span class="keyword">and</span> <span class="string">"show warranty"</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured <span class="keyword">as</span> <span class="string">"i686-linux-gnu"</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;<span class="keyword">http</span>://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Attaching <span class="built_in">to</span> <span class="built_in">process</span> <span class="number">8043</span></span><br><span class="line">Could <span class="keyword">not</span> attach <span class="built_in">to</span> <span class="built_in">process</span>.  If your uid matches <span class="keyword">the</span> uid <span class="keyword">of</span> <span class="keyword">the</span> target</span><br><span class="line"><span class="built_in">process</span>, check <span class="keyword">the</span> setting <span class="keyword">of</span> /proc/sys/kernel/yama/ptrace_scope, <span class="keyword">or</span> <span class="keyword">try</span></span><br><span class="line">again <span class="keyword">as</span> <span class="keyword">the</span> root user.  For more details, see /etc/sysctl.d/<span class="number">10</span>-ptrace.conf</span><br><span class="line">ptrace: Operation <span class="keyword">not</span> permitted.</span><br><span class="line">(gdb) quit</span><br></pre></td></tr></table></figure>
<p>重新<code>sudo gdb -p pid</code>进入进程。</p>
<ul>
<li>使用<code>bt</code>查看当前调用栈信息（<strong>call stack</strong>，即函数调用层次信息），当前进程的是由main() -&gt; sleep() -&gt; nanosleep() -&gt; __kernel_vsyscall()一层一层调入。注意“<em>#数字</em>”，在GDB中这叫<strong>stack frames</strong>，或直接称为<strong>frame</strong>，运行栈由一个或多个连续的frame组成，数字越小代表调用层次越深。  </li>
<li>使用<code>bt full</code>查看详细调用栈信息，会把各个frame的入参和局部变量信息显示出来。这里bt是backtrace的缩写，GDB的全命令经常有其简短的写法。  </li>
</ul>
<p><strong>注意</strong>：GDB中，按回车默认是执行上一次命令。<br>先MARK下面的“<em>No symbol table info available.</em>”</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ sudo gdb -p <span class="number">8043</span></span><br><span class="line">[sudo] password <span class="keyword">for</span> <span class="symbol">sunnogo:</span> </span><br><span class="line">GNU gdb (GDB) <span class="number">7.5</span>-ubuntu</span><br><span class="line">Copyright (C) <span class="number">2012</span> Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version <span class="number">3</span> or later &lt;<span class="symbol">http:</span>/<span class="regexp">/gnu.org/licenses</span><span class="regexp">/gpl.html&gt;</span></span><br><span class="line"><span class="regexp">This is free software: you are free to change and redistribute it.</span></span><br><span class="line"><span class="regexp">There is NO WARRANTY, to the extent permitted by law.  Type "show copying"</span></span><br><span class="line"><span class="regexp">and "show warranty" for details.</span></span><br><span class="line"><span class="regexp">This GDB was configured as "i686-linux-gnu".</span></span><br><span class="line"><span class="regexp">For bug reporting instructions, please see:</span></span><br><span class="line"><span class="regexp">&lt;http:/</span><span class="regexp">/www.gnu.org/software</span><span class="regexp">/gdb/bugs</span><span class="regexp">/&gt;.</span></span><br><span class="line"><span class="regexp">Attaching to process 8043</span></span><br><span class="line"><span class="regexp">Reading symbols from /home</span><span class="regexp">/sunnogo/test</span><span class="regexp">/gdb/prt</span>_mod_var...done.</span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libc</span>.<span class="title">so</span>.6...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libc</span>.<span class="title">so</span>.6</span></span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">ld</span>-<span class="title">linux</span>.<span class="title">so</span>.2...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">ld</span>-<span class="title">linux</span>.<span class="title">so</span>.2</span></span><br><span class="line"><span class="number">0xb7751424</span> in __kernel_vsyscall ()</span><br><span class="line">(gdb) bt </span><br><span class="line"><span class="comment">#0  0xb7751424 in __kernel_vsyscall ()</span></span><br><span class="line"><span class="comment">#1  0xb7640ce0 in nanosleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line"><span class="comment">#2  0xb7640aff in sleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line"><span class="comment">#3  0x0804845b in stay_here (arg=999, test=0xbf8e5118) at prt_mod_var.c:26</span></span><br><span class="line"><span class="comment">#4  0x08048492 in main (argc=1, argv=0xbf8e51c4) at prt_mod_var.c:41</span></span><br><span class="line">(gdb) bt full</span><br><span class="line"><span class="comment">#0  0xb7751424 in __kernel_vsyscall ()</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#1  0xb7640ce0 in nanosleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#2  0xb7640aff in sleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#3  0x0804845b in stay_here (arg=999, test=0xbf8e5118) at prt_mod_var.c:26</span></span><br><span class="line">        local = <span class="number">113</span></span><br><span class="line"><span class="comment">#4  0x08048492 in main (argc=1, argv=0xbf8e51c4) at prt_mod_var.c:41</span></span><br><span class="line">        local = <span class="number">999</span></span><br><span class="line">        test = &#123;member_a = <span class="number">10</span>, member_b = <span class="number">11</span>&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>frame n</code>进入“<em>#n</em>”的frame。默认显示当前函数名、函数入参、当前运行处所在源文件的代码行位置，并显示当前行代码。</li>
<li>使用<code>info</code>命令查看frame详细信息，info命令不是全命令，后面还有子命令。info有很多子命令，除本frame外，还可以查看本进程信息、系统信息，这里仅仅是冰山一角。<ul>
<li><code>info frame</code> 显示当前frame信息</li>
<li><code>info args</code> 显示入参信息</li>
<li><code>info local</code> 显示局部变量信息</li>
</ul>
</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(gdb) frame <span class="number">3</span></span><br><span class="line">#<span class="number">3</span>  <span class="number">0x0804845b</span> <span class="keyword">in</span> stay_here (arg=<span class="number">999</span>, <span class="keyword">test</span>=<span class="number">0xbf8e5118</span>) <span class="meta">at</span> prt_mod_var.c:<span class="number">26</span></span><br><span class="line"><span class="number">26</span>              sleep(<span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">(gdb) info frame</span><br><span class="line">Stack level <span class="number">3</span>, frame <span class="meta">at</span> <span class="number">0xbf8e5100</span>:</span><br><span class="line"> <span class="built_in">eip</span> = <span class="number">0x804845b</span> <span class="keyword">in</span> stay_here (prt_mod_var.c:<span class="number">26</span>)<span class="comment">; saved eip 0x8048492</span></span><br><span class="line"> called by frame <span class="meta">at</span> <span class="number">0xbf8e5130</span>, caller of frame <span class="meta">at</span> <span class="number">0xbf8e50d0</span></span><br><span class="line"> source language c.</span><br><span class="line"> Arglist <span class="meta">at</span> <span class="number">0xbf8e50f8</span>, args: arg=<span class="number">999</span>, <span class="keyword">test</span>=<span class="number">0xbf8e5118</span></span><br><span class="line"> Locals <span class="meta">at</span> <span class="number">0xbf8e50f8</span>, Previous frame<span class="string">'s sp is 0xbf8e5100</span></span><br><span class="line"><span class="string"> Saved registers:</span></span><br><span class="line"><span class="string">  ebx at 0xbf8e50f4, ebp at 0xbf8e50f8, eip at 0xbf8e50fc</span></span><br><span class="line"><span class="string">(gdb) info args</span></span><br><span class="line"><span class="string">arg = 999</span></span><br><span class="line"><span class="string">test = 0xbf8e5118</span></span><br><span class="line"><span class="string">(gdb) info local</span></span><br><span class="line"><span class="string">local = 113</span></span><br><span class="line"><span class="string">(gdb)</span></span><br></pre></td></tr></table></figure>
<h2 id="查看、修改变量"><a href="#查看、修改变量" class="headerlink" title="查看、修改变量"></a>查看、修改变量</h2><p><code>p var</code>查看变量信息，p是print的缩写。</p>
<ul>
<li><code>p var</code></li>
<li><code>p *(指针类型)地址</code></li>
<li><code>p *结构体指针</code></li>
<li><code>p 数组名</code></li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 打印变量 </span><br><span class="line">(gdb) p g_int</span><br><span class="line">$<span class="number">3</span> = <span class="number">0</span></span><br><span class="line">(gdb) p g_bool</span><br><span class="line">$<span class="number">4</span> = false</span><br><span class="line"></span><br><span class="line"># 打印特定类型指针</span><br><span class="line">(gdb) info local</span><br><span class="line">local = <span class="number">113</span></span><br><span class="line">(gdb) p &amp;local</span><br><span class="line">$<span class="number">11</span> = (int *) <span class="number">0xbf8e50ec</span></span><br><span class="line">(gdb) p *(int *) <span class="number">0xbf8e50ec</span></span><br><span class="line">$<span class="number">12</span> = <span class="number">113</span></span><br><span class="line">(gdb) </span><br><span class="line"></span><br><span class="line"># 打印结构体指针</span><br><span class="line">(gdb) p test</span><br><span class="line">$<span class="number">1</span> = (test_t *) <span class="number">0xbf8e5118</span></span><br><span class="line">(gdb) p *test</span><br><span class="line">$<span class="number">2</span> = &#123;member_a = <span class="number">10</span>, member_b = <span class="number">11</span>&#125;</span><br><span class="line"></span><br><span class="line"># 打印数组名</span><br><span class="line">(gdb) p g_str</span><br><span class="line">$<span class="number">5</span> = &#123;<span class="number">0x8048538</span> <span class="string">"Hello, GDB!"</span>, <span class="number">0x8048544</span> <span class="string">"It's funny."</span>&#125;</span><br><span class="line">(gdb) p g_str[<span class="number">0</span>]</span><br><span class="line">$<span class="number">6</span> = <span class="number">0x8048538</span> <span class="string">"Hello, GDB!"</span></span><br></pre></td></tr></table></figure>
<p><code>print</code>不仅可以用来查看变量，还可用于设置变量。<code>print var=value</code>。<br>设置变量值的命令还有<code>set</code>，<code>set var=value</code>。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set int</span></span><br><span class="line">(gdb) <span class="builtin-name">print</span> local</span><br><span class="line"><span class="variable">$1</span> = 109</span><br><span class="line">(gdb) <span class="builtin-name">print</span> <span class="attribute">local</span>=20</span><br><span class="line"><span class="variable">$2</span> = 20</span><br><span class="line">(gdb) <span class="builtin-name">print</span> local</span><br><span class="line"><span class="variable">$3</span> = 20</span><br><span class="line">(gdb) <span class="builtin-name">set</span> <span class="attribute">local</span>=30</span><br><span class="line">(gdb) <span class="builtin-name">print</span> local</span><br><span class="line"><span class="variable">$4</span> = 30</span><br><span class="line"></span><br><span class="line"><span class="comment"># set bool</span></span><br><span class="line">(gdb) <span class="builtin-name">print</span> g_bool</span><br><span class="line"><span class="variable">$5</span> = <span class="literal">false</span></span><br><span class="line">(gdb) <span class="builtin-name">set</span> <span class="attribute">g_bool</span>=<span class="literal">true</span></span><br><span class="line"><span class="literal">No</span> symbol <span class="string">"true"</span> <span class="keyword">in</span> current context.</span><br><span class="line">(gdb) <span class="builtin-name">set</span> <span class="attribute">g_bool</span>=1</span><br><span class="line">(gdb) <span class="builtin-name">print</span> g_bool</span><br><span class="line"><span class="variable">$6</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set pointer</span></span><br><span class="line">(gdb) <span class="builtin-name">print</span> g_str</span><br><span class="line"><span class="variable">$7</span> = &#123;0x8048538 <span class="string">"Hello, GDB!"</span>, 0x8048544 <span class="string">"It's funny."</span>&#125;</span><br><span class="line">(gdb) <span class="builtin-name">set</span> g_str[0]=<span class="string">"SETTING VAR"</span></span><br><span class="line">(gdb) <span class="builtin-name">print</span> g_str</span><br><span class="line"><span class="variable">$8</span> = &#123;0x8e05008 <span class="string">"SETTING VAR"</span>, 0x8048544 <span class="string">"It's funny."</span>&#125;</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<h2 id="查看内存"><a href="#查看内存" class="headerlink" title="查看内存"></a>查看内存</h2><p><code>examine</code>查看内存，缩写是<code>x</code>。命令格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x/<span class="tag">&lt;<span class="name">n</span>/<span class="attr">f</span>/<span class="attr">u</span>&gt;</span> <span class="tag">&lt;<span class="name">addr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>n、f、u是可选参数，说明如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="keyword">help</span> x</span><br><span class="line">Examine <span class="keyword">memory</span>: x/FMT ADDRESS.</span><br><span class="line">ADDRESS <span class="keyword">is</span> an expression <span class="keyword">for</span> the <span class="keyword">memory</span> address <span class="keyword">to</span> examine.</span><br><span class="line">FMT <span class="keyword">is</span> a <span class="keyword">repeat</span> <span class="keyword">count</span> followed <span class="keyword">by</span> a <span class="keyword">format</span> letter <span class="keyword">and</span> a <span class="keyword">size</span> letter.</span><br><span class="line"><span class="keyword">Format</span> letters <span class="keyword">are</span> o(octal), x(<span class="keyword">hex</span>), d(<span class="built_in">decimal</span>), u(<span class="keyword">unsigned</span> <span class="built_in">decimal</span>),</span><br><span class="line">  t(<span class="built_in">binary</span>), f(<span class="built_in">float</span>), a(address), i(instruction), c(<span class="built_in">char</span>) <span class="keyword">and</span> s(<span class="keyword">string</span>).</span><br><span class="line"><span class="keyword">Size</span> letters <span class="keyword">are</span> b(<span class="keyword">byte</span>), h(halfword), w(word), g(giant, <span class="number">8</span> <span class="keyword">bytes</span>).</span><br><span class="line">The specified <span class="built_in">number</span> <span class="keyword">of</span> objects <span class="keyword">of</span> the specified <span class="keyword">size</span> <span class="keyword">are</span> printed</span><br><span class="line">according <span class="keyword">to</span> the format.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Defaults</span> <span class="keyword">for</span> <span class="keyword">format</span> <span class="keyword">and</span> <span class="keyword">size</span> letters <span class="keyword">are</span> those previously used.</span><br><span class="line"><span class="keyword">Default</span> <span class="keyword">count</span> <span class="keyword">is</span> <span class="number">1.</span>  <span class="keyword">Default</span> address <span class="keyword">is</span> <span class="keyword">following</span> <span class="keyword">last</span> thing printed</span><br><span class="line"><span class="keyword">with</span> this command <span class="keyword">or</span> <span class="string">"print"</span>.</span><br></pre></td></tr></table></figure>
<ul>
<li><code>n</code>表示要打印的多少个单位的内存，默认是1，单位由<code>u</code>定义；</li>
<li><code>f</code>表示打印的格式，格式有：<ul>
<li><em>o</em>，octal，八进制；</li>
<li><em>x</em>，hex，十六进制；</li>
<li><em>d</em>，decimal，十进制；</li>
<li><em>u</em>，unsigned decimal，无符号十进制；</li>
<li><em>t</em>，binary，二进制；</li>
<li><em>f</em>，float；</li>
<li><em>a</em>，address；</li>
<li><em>i</em>，instruction，指令；</li>
<li><em>c</em>，char，字符；</li>
<li><em>s</em>，string，字符串。</li>
</ul>
</li>
<li><code>u</code>定义单位，<em>b</em>表示1字节，<em>h</em>表示2字节，<em>w</em>表示4字节，<em>g</em>表示8字节。</li>
</ul>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前CPU是intel i3，小端</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以十进制形式打印</span></span><br><span class="line">(gdb) x/8db test</span><br><span class="line">0xbf8e5118:    <span class="number"> 10 </span>    <span class="number"> 0 </span>     <span class="number"> 0 </span>     <span class="number"> 0 </span>     <span class="number"> 11 </span>    <span class="number"> 0 </span>     <span class="number"> 0 </span>      0</span><br><span class="line">(gdb) x/4dh test</span><br><span class="line">0xbf8e5118:    <span class="number"> 10 </span>    <span class="number"> 0 </span>     <span class="number"> 11 </span>     0</span><br><span class="line">(gdb) x/2dw test</span><br><span class="line">0xbf8e5118:    <span class="number"> 10 </span>     11</span><br><span class="line">(gdb) x/2d test</span><br><span class="line">0xbf8e5118:    <span class="number"> 10 </span>     11</span><br><span class="line">(gdb) x/1dg test</span><br><span class="line">0xbf8e5118:    <span class="number"> 47244640266 </span> <span class="comment"># 注意和x/1xg test的结果比较</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以二进制形式打印</span></span><br><span class="line">(gdb) x/1tg test</span><br><span class="line">0xbf8e5118:     0000000000000000000000000000101100000000000000000000000000001010</span><br><span class="line">(gdb) x/2tw test</span><br><span class="line">0xbf8e5118:    <span class="number"> 00000000000000000000000000001010 </span>       00000000000000000000000000001011</span><br><span class="line">(gdb) x/4th test</span><br><span class="line">0xbf8e5118:    <span class="number"> 0000000000001010 </span>      <span class="number"> 0000000000000000 </span>      <span class="number"> 0000000000001011 </span>       0000000000000000</span><br><span class="line">(gdb) x/8tb test</span><br><span class="line">0xbf8e5118:    <span class="number"> 00001010 </span>      <span class="number"> 00000000 </span>      <span class="number"> 00000000 </span>      <span class="number"> 00000000 </span>      <span class="number"> 00001011 </span>      <span class="number"> 0000000000000000 </span>       00000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以十六进制形式打印</span></span><br><span class="line">(gdb) x/8xb test</span><br><span class="line">0xbf8e5118:     0x0a    0x00    0x00    0x00    0x0b    0x00    0x00    0x00</span><br><span class="line">(gdb) x/4xh test</span><br><span class="line">0xbf8e5118:     0x000a  0x0000  0x000b  0x0000</span><br><span class="line">(gdb) x/2xw test</span><br><span class="line">0xbf8e5118:     0x0000000a      0x0000000b</span><br><span class="line">(gdb) x/1xg test</span><br><span class="line">0xbf8e5118:     0x0000000b0000000a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印字符或字符串</span></span><br><span class="line">(gdb) x/30cb g_str[0]</span><br><span class="line">0x8048538:     <span class="number"> 72 </span>'H' <span class="number"> 101 </span>'e'<span class="number"> 108 </span>'l'<span class="number"> 108 </span>'l'<span class="number"> 111 </span>'o'<span class="number"> 44 </span>',' <span class="number"> 32 </span>' ' <span class="number"> 71 </span>'G'</span><br><span class="line">0x8048540:     <span class="number"> 68 </span>'D' <span class="number"> 66 </span>'B' <span class="number"> 33 </span>'!' <span class="number"> 0 </span>'\000'       <span class="number"> 73 </span>'I' <span class="number"> 116 </span>'t'<span class="number"> 39 </span>'\''<span class="number"> 115 </span>'s'</span><br><span class="line">0x8048548:     <span class="number"> 32 </span>' ' <span class="number"> 102 </span>'f'<span class="number"> 117 </span>'u'<span class="number"> 110 </span>'n'<span class="number"> 110 </span>'n'<span class="number"> 121 </span>'y'<span class="number"> 46 </span>'.' <span class="number"> 0 </span>'\000'</span><br><span class="line">0x8048550:     <span class="number"> 1 </span>'\001'       <span class="number"> 27 </span>'\033'      <span class="number"> 3 </span>'\003'       <span class="number"> 59 </span>';' <span class="number"> 56 </span>'8' <span class="number"> 0 </span>'\000'</span><br><span class="line">(gdb) x/s g_str[0]</span><br><span class="line">0x8048538:      "Hello, GDB!"</span><br></pre></td></tr></table></figure>
<h2 id="查看线程信息"><a href="#查看线程信息" class="headerlink" title="查看线程信息"></a>查看线程信息</h2><p>有两种方法可以进入线程调试：</p>
<ul>
<li>设置线程名，用ps查看母进程的线程信息，获取tid，再启动GDB进入；</li>
<li>直接启动GDB调试母进程，<code>info thread</code>查看所有线程信息，获取到想要的线程的GDB内部编号n，<code>thread n</code>进入线程的调用栈。</li>
</ul>
<h3 id="直接获取、调试线程"><a href="#直接获取、调试线程" class="headerlink" title="直接获取、调试线程"></a>直接获取、调试线程</h3><p>上面样例中创建5条线程，并使用<em>prctl</em>函数为每条线程命名为”test-n”。<br>这样可以通过<code>ps -eL | grep test（或者test进程的pid）</code>来查看刚创建的线程的tid。然后<code>gdb -p tid</code>进入线程调度。这里进入编号为4的线程。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ gcc -o test test.c -g -Wall -lpthread</span><br><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ ./test &amp;</span><br><span class="line">[<span class="number">2</span>] <span class="number">16427</span></span><br><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ ps -eL | grep test</span><br><span class="line"><span class="number">16427</span> <span class="number">16427</span> pts/<span class="number">1</span>    <span class="number">0</span>0:<span class="number">0</span>0:<span class="number">0</span>0 test</span><br><span class="line"><span class="number">16427</span> <span class="number">16428</span> pts/<span class="number">1</span>    <span class="number">0</span>0:<span class="number">0</span>0:<span class="number">0</span>0 test-<span class="number">1</span></span><br><span class="line"><span class="number">16427</span> <span class="number">16429</span> pts/<span class="number">1</span>    <span class="number">0</span>0:<span class="number">0</span>0:<span class="number">0</span>0 test-<span class="number">2</span></span><br><span class="line"><span class="number">16427</span> <span class="number">16430</span> pts/<span class="number">1</span>    <span class="number">0</span>0:<span class="number">0</span>0:<span class="number">0</span>0 test-<span class="number">3</span></span><br><span class="line"><span class="number">16427</span> <span class="number">16431</span> pts/<span class="number">1</span>    <span class="number">0</span>0:<span class="number">0</span>0:<span class="number">0</span>0 test-<span class="number">4</span></span><br><span class="line"><span class="number">16427</span> <span class="number">16432</span> pts/<span class="number">1</span>    <span class="number">0</span>0:<span class="number">0</span>0:<span class="number">0</span>0 test-<span class="number">5</span></span><br><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ sudo gdb -p <span class="number">16431</span></span><br><span class="line">GNU gdb (GDB) <span class="number">7.5</span>-ubuntu</span><br><span class="line">Copyright (C) <span class="number">2012</span> Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version <span class="number">3</span> or later &lt;<span class="symbol">http:</span>/<span class="regexp">/gnu.org/licenses</span><span class="regexp">/gpl.html&gt;</span></span><br><span class="line"><span class="regexp">This is free software: you are free to change and redistribute it.</span></span><br><span class="line"><span class="regexp">There is NO WARRANTY, to the extent permitted by law.  Type "show copying"</span></span><br><span class="line"><span class="regexp">and "show warranty" for details.</span></span><br><span class="line"><span class="regexp">This GDB was configured as "i686-linux-gnu".</span></span><br><span class="line"><span class="regexp">For bug reporting instructions, please see:</span></span><br><span class="line"><span class="regexp">&lt;http:/</span><span class="regexp">/www.gnu.org/software</span><span class="regexp">/gdb/bugs</span><span class="regexp">/&gt;.</span></span><br><span class="line"><span class="regexp">Attaching to process 16431</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">warning: process 16431 is a cloned process</span></span><br><span class="line"><span class="regexp">Reading symbols from /home</span><span class="regexp">/sunnogo/test</span><span class="regexp">/gdb/test</span>...done.</span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libpthread</span>.<span class="title">so</span>.0...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">"/lib/i386-linux-gnu/libthread_db.so.1"</span>.</span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libpthread</span>.<span class="title">so</span>.0</span></span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libc</span>.<span class="title">so</span>.6...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libc</span>.<span class="title">so</span>.6</span></span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">ld</span>-<span class="title">linux</span>.<span class="title">so</span>.2...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">ld</span>-<span class="title">linux</span>.<span class="title">so</span>.2</span></span><br><span class="line"><span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">(gdb) bt full</span><br><span class="line"><span class="comment">#0  0xb774f424 in __kernel_vsyscall ()</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#1  0xb7623d06 in nanosleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#2  0xb7623aff in sleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#3  0x080485ee in thread_process (arg=0x3) at test.c:46</span></span><br><span class="line">        in = <span class="number">3</span></span><br><span class="line">        name = <span class="string">"test-4"</span>, <span class="string">'\000'</span> &lt;repeats <span class="number">57</span> times&gt;</span><br><span class="line"><span class="comment">#4  0xb771cd4c in start_thread () from /lib/i386-linux-gnu/libpthread.so.0</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#5  0xb765abae in clone () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<h3 id="间接获取、调试线程"><a href="#间接获取、调试线程" class="headerlink" title="间接获取、调试线程"></a>间接获取、调试线程</h3><p>注意和上一种方法的对比，相比起来，第一种方法要方便得多。也从侧面看出为每个线程命名的重要性。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ </span><br><span class="line">nnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ sudo gdb attach <span class="number">16427</span></span><br><span class="line">GNU gdb (GDB) <span class="number">7.5</span>-ubuntu</span><br><span class="line">Copyright (C) <span class="number">2012</span> Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version <span class="number">3</span> or later &lt;<span class="symbol">http:</span>/<span class="regexp">/gnu.org/licenses</span><span class="regexp">/gpl.html&gt;</span></span><br><span class="line"><span class="regexp">This is free software: you are free to change and redistribute it.</span></span><br><span class="line"><span class="regexp">There is NO WARRANTY, to the extent permitted by law.  Type "show copying"</span></span><br><span class="line"><span class="regexp">and "show warranty" for details.</span></span><br><span class="line"><span class="regexp">This GDB was configured as "i686-linux-gnu".</span></span><br><span class="line"><span class="regexp">For bug reporting instructions, please see:</span></span><br><span class="line"><span class="regexp">&lt;http:/</span><span class="regexp">/www.gnu.org/software</span><span class="regexp">/gdb/bugs</span><span class="regexp">/&gt;...</span></span><br><span class="line"><span class="regexp">attach: No such file or directory.</span></span><br><span class="line"><span class="regexp">Attaching to process 16427</span></span><br><span class="line"><span class="regexp">Reading symbols from /home</span><span class="regexp">/sunnogo/test</span><span class="regexp">/gdb/test</span>...done.</span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libpthread</span>.<span class="title">so</span>.0...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">[New LWP <span class="number">16432</span>]</span><br><span class="line">[New LWP <span class="number">16431</span>]</span><br><span class="line">[New LWP <span class="number">16430</span>]</span><br><span class="line">[New LWP <span class="number">16429</span>]</span><br><span class="line">[New LWP <span class="number">16428</span>]</span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">"/lib/i386-linux-gnu/libthread_db.so.1"</span>.</span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libpthread</span>.<span class="title">so</span>.0</span></span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libc</span>.<span class="title">so</span>.6...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">i386</span>-<span class="title">linux</span>-<span class="title">gnu</span>/<span class="title">libc</span>.<span class="title">so</span>.6</span></span><br><span class="line">Reading symbols from /<span class="class"><span class="keyword">lib</span>/<span class="title">ld</span>-<span class="title">linux</span>.<span class="title">so</span>.2...(<span class="title">no</span> <span class="title">debugging</span> <span class="title">symbols</span> <span class="title">found</span>)...<span class="title">done</span>.</span></span><br><span class="line">Loaded symbols <span class="keyword">for</span> /<span class="class"><span class="keyword">lib</span>/<span class="title">ld</span>-<span class="title">linux</span>.<span class="title">so</span>.2</span></span><br><span class="line"><span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">(gdb) info thread</span><br><span class="line">  Id   Target Id         Frame </span><br><span class="line">  <span class="number">6</span>    Thread <span class="number">0xb7568b40</span> (LWP <span class="number">16428</span>) <span class="string">"test-1"</span> <span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">  <span class="number">5</span>    Thread <span class="number">0xb6d67b40</span> (LWP <span class="number">16429</span>) <span class="string">"test-2"</span> <span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">  <span class="number">4</span>    Thread <span class="number">0xb6566b40</span> (LWP <span class="number">16430</span>) <span class="string">"test-3"</span> <span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">  <span class="number">3</span>    Thread <span class="number">0xb5d65b40</span> (LWP <span class="number">16431</span>) <span class="string">"test-4"</span> <span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">  <span class="number">2</span>    Thread <span class="number">0xb5564b40</span> (LWP <span class="number">16432</span>) <span class="string">"test-5"</span> <span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">* <span class="number">1</span>    Thread <span class="number">0xb75696c0</span> (LWP <span class="number">16427</span>) <span class="string">"test"</span> <span class="number">0xb774f424</span> in __kernel_vsyscall ()</span><br><span class="line">(gdb) thread <span class="number">3</span></span><br><span class="line">[Switching to thread <span class="number">3</span> (Thread <span class="number">0xb5d65b40</span> (LWP <span class="number">16431</span>))]</span><br><span class="line"><span class="comment">#0  0xb774f424 in __kernel_vsyscall ()</span></span><br><span class="line">(gdb) bt full</span><br><span class="line"><span class="comment">#0  0xb774f424 in __kernel_vsyscall ()</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#1  0xb7623d06 in nanosleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#2  0xb7623aff in sleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#3  0x080485ee in thread_process (arg=0x3) at test.c:46</span></span><br><span class="line">        in = <span class="number">3</span></span><br><span class="line">        name = <span class="string">"test-4"</span>, <span class="string">'\000'</span> &lt;repeats <span class="number">57</span> times&gt;</span><br><span class="line"><span class="comment">#4  0xb771cd4c in start_thread () from /lib/i386-linux-gnu/libpthread.so.0</span></span><br><span class="line">No symbol table info available.</span><br><span class="line"><span class="comment">#5  0xb765abae in clone () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line">No symbol table info available.</span><br><span class="line">(gdb) q</span><br><span class="line">A debugging session is active.</span><br><span class="line"></span><br><span class="line">        Inferior <span class="number">1</span> [process <span class="number">16427</span>] will be detached.</span><br><span class="line"></span><br><span class="line">Quit anyway? (y or n) y</span><br><span class="line">Detaching from <span class="symbol">program:</span> /home/sunnogo/test/gdb/test, process <span class="number">16427</span></span><br><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$ </span><br><span class="line">sunnogo@<span class="symbol">a3e420:</span>~<span class="regexp">/test/gdb</span>$</span><br></pre></td></tr></table></figure>
<h3 id="查看所有线程堆栈"><a href="#查看所有线程堆栈" class="headerlink" title="查看所有线程堆栈"></a>查看所有线程堆栈</h3><p>使用 <code>thread apply all bt full</code>，查看所有线程的堆栈，如果线程多，可能会产生短暂刷屏。</p>
<h2 id="gdb中调用调用函数"><a href="#gdb中调用调用函数" class="headerlink" title="gdb中调用调用函数"></a>gdb中调用调用函数</h2><p><code>call func_name(param1, param2, ...)</code>，目前还没有明白如果参数是结构体要怎么整。注意，只能在进程上下文中才能使用，coredump中无法使用。</p>
<h2 id="gdb中申请内存"><a href="#gdb中申请内存" class="headerlink" title="gdb中申请内存"></a>gdb中申请内存</h2><p><code>p malloc(size)</code>，结果会返回一个指针，即可正常使用这个指针。注意，只能在进程上下文中才能使用，coredump中无法使用。如下例：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p malloc(<span class="number">4</span>)</span><br><span class="line">[New Thread <span class="number">0x693ff460</span> (LWP <span class="number">2033</span>)]</span><br><span class="line">[Switching to Thread <span class="number">0xb6101000</span> (LWP <span class="number">1456</span>)]</span><br><span class="line">$<span class="number">1</span> = (void *) <span class="number">0xb58d01e0</span>    &lt;----使用这个返回的指针。</span><br></pre></td></tr></table></figure>
<h2 id="查看寄存器信息"><a href="#查看寄存器信息" class="headerlink" title="查看寄存器信息"></a>查看寄存器信息</h2><p>to-do</p>
<h2 id="GDB反汇编"><a href="#GDB反汇编" class="headerlink" title="GDB反汇编"></a>GDB反汇编</h2><p>to-do</p>
<h2 id="断点设置"><a href="#断点设置" class="headerlink" title="断点设置"></a>断点设置</h2><p>to-do</p>
<h2 id="内存监控"><a href="#内存监控" class="headerlink" title="内存监控"></a>内存监控</h2><p>to-do</p>
<h2 id="GCC选项对GDB的影响"><a href="#GCC选项对GDB的影响" class="headerlink" title="GCC选项对GDB的影响"></a>GCC选项对GDB的影响</h2><h3 id="GCC-g选项的影响"><a href="#GCC-g选项的影响" class="headerlink" title="GCC -g选项的影响"></a>GCC -g选项的影响</h3><p>注意上面的，如果gcc编译的时候不加<code>-g</code>选项，那么frame 3也会显示“<em>No symbol table info available.</em>”，无符号表信息可用，全局变量g_str也打不出来。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(gdb) bt full</span><br><span class="line"><span class="comment">#0  0xb77a3424 in __kernel_vsyscall ()</span></span><br><span class="line"><span class="literal">No</span> symbol table <span class="builtin-name">info</span> available.</span><br><span class="line"><span class="comment">#1  0xb7692ce0 in nanosleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line"><span class="literal">No</span> symbol table <span class="builtin-name">info</span> available.</span><br><span class="line"><span class="comment">#2  0xb7692aff in sleep () from /lib/i386-linux-gnu/libc.so.6</span></span><br><span class="line"><span class="literal">No</span> symbol table <span class="builtin-name">info</span> available.</span><br><span class="line"><span class="comment">#3  0x08048462 in main ()</span></span><br><span class="line"><span class="literal">No</span> symbol table <span class="builtin-name">info</span> available.</span><br><span class="line">(gdb) p g_str</span><br><span class="line"><span class="variable">$1</span> = 134513928</span><br><span class="line">(gdb) p g_str[0]</span><br><span class="line">cannot subscript something of<span class="built_in"> type </span>`&lt;data variable, <span class="literal">no</span> <span class="builtin-name">debug</span> info&gt;'</span><br><span class="line">(gdb) p g_bool</span><br><span class="line"><span class="variable">$2</span> = 0</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<h3 id="GCC-fomit-frame-pointer选项的影响"><a href="#GCC-fomit-frame-pointer选项的影响" class="headerlink" title="GCC -fomit-frame-pointer选项的影响"></a>GCC -fomit-frame-pointer选项的影响</h3>
    </div>

    
    
    

    <footer class="post-footer">
          
        
        <div class="post-tags">
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
            <a href="/tags/调试/" rel="tag"># 调试</a>
          
            <a href="/tags/GDB/" rel="tag"># GDB</a>
          
        </div>
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
              <a href="/201504/tools/git-quick-start.html" rel="next" title="Git quick start">
                <i class="fa fa-chevron-left"></i> Git quick start
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
              <a href="/201507/networks/mac.html" rel="prev" title="MAC地址">
                MAC地址 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
  


        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" src="/images/default_avatar.jpg" alt="sunnogo">
  <p class="site-author-name" itemprop="name">sunnogo</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">148</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">110</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动GDB"><span class="nav-number">2.</span> <span class="nav-text">启动GDB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GCC选项"><span class="nav-number">2.1.</span> <span class="nav-text">GCC选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动GDB-1"><span class="nav-number">2.2.</span> <span class="nav-text">启动GDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#善用help"><span class="nav-number">2.3.</span> <span class="nav-text">善用help</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看调用栈"><span class="nav-number">3.</span> <span class="nav-text">查看调用栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看、修改变量"><span class="nav-number">4.</span> <span class="nav-text">查看、修改变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看内存"><span class="nav-number">5.</span> <span class="nav-text">查看内存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看线程信息"><span class="nav-number">6.</span> <span class="nav-text">查看线程信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#直接获取、调试线程"><span class="nav-number">6.1.</span> <span class="nav-text">直接获取、调试线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#间接获取、调试线程"><span class="nav-number">6.2.</span> <span class="nav-text">间接获取、调试线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看所有线程堆栈"><span class="nav-number">6.3.</span> <span class="nav-text">查看所有线程堆栈</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb中调用调用函数"><span class="nav-number">7.</span> <span class="nav-text">gdb中调用调用函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb中申请内存"><span class="nav-number">8.</span> <span class="nav-text">gdb中申请内存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看寄存器信息"><span class="nav-number">9.</span> <span class="nav-text">查看寄存器信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GDB反汇编"><span class="nav-number">10.</span> <span class="nav-text">GDB反汇编</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#断点设置"><span class="nav-number">11.</span> <span class="nav-text">断点设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存监控"><span class="nav-number">12.</span> <span class="nav-text">内存监控</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GCC选项对GDB的影响"><span class="nav-number">13.</span> <span class="nav-text">GCC选项对GDB的影响</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GCC-g选项的影响"><span class="nav-number">13.1.</span> <span class="nav-text">GCC -g选项的影响</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GCC-fomit-frame-pointer选项的影响"><span class="nav-number">13.2.</span> <span class="nav-text">GCC -fomit-frame-pointer选项的影响</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sunnogo</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  <script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>

  
  <script src="/js/schemes/muse.js?v=7.3.0"></script>



  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>



  <script src="/js/next-boot.js?v=7.3.0"></script>

  

  

  


  























  <script src="/js/local-search.js?v=7.3.0"></script>













    
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://sunyongfeng-com.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://sunyongfeng.com/201506/programmer/tools/gdb.html";
    this.page.identifier = "201506/programmer/tools/gdb.html";
    this.page.title = 'GDB使用记录';};
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://sunyongfeng-com.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
    window.addEventListener('load', loadComments, false);
  
</script>


</body>
</html>
