<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>p4app 仓库 —— 用于快速验证 P4 程序 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="p4app 仓库使用说明。">
<meta name="keywords" content="p4,p4app,快速验证,p4lang,github,repo,topo,stf,bmv2,build,compile,docker,mininet,仓库">
<meta property="og:type" content="article">
<meta property="og:title" content="p4app 仓库 —— 用于快速验证 P4 程序">
<meta property="og:url" content="http://yoursite.com/2017/05/10/networks/p4/repo_p4app/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="p4app 仓库使用说明。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-04-17T09:58:07.073Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="p4app 仓库 —— 用于快速验证 P4 程序">
<meta name="twitter:description" content="p4app 仓库使用说明。">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-networks/p4/repo_p4app" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/10/networks/p4/repo_p4app/" class="article-date">
  <time datetime="2017-05-10T08:41:00.000Z" itemprop="datePublished">2017-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/p4/">p4</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      p4app 仓库 —— 用于快速验证 P4 程序
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文译自 <a href="https://github.com/p4lang/p4app/blob/master/README.md" target="_blank" rel="noopener">p4app README</a>，对内容结构进行少量调整，并附上运行 log。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="https://github.com/p4lang/p4app" target="_blank" rel="noopener">p4app</a> 仓库创建于 2017-02-23，是一种构建、运行、调试和测试 P4 程序的工具。哲学是“简单的东西应尽可能简单”，旨在使小而简单的 P4 程序易于编写、易于与他人分享。</p>
<p><a href="https://github.com/p4lang/p4factory" target="_blank" rel="noopener">p4factory</a> 或 <a href="https://github.com/p4lang/switch" target="_blank" rel="noopener">switch</a> 等 P4 样例依赖安装步骤复杂、编译时间超长。p4app 可很好地解决此问题，降低 P4 入门门槛。与预期的相符，p4app 将 bmv2 等基础组件整合成一个 docker image。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>下载 p4app</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/p4lang/p4app</span><br></pre></td></tr></table></figure>
<ul>
<li>Bug fix.</li>
</ul>
<p>p4app bug: <a href="https://github.com/p4lang/p4app/pull/17" target="_blank" rel="noopener">pull request 17</a>，docker 镜像名已由 <code>p4lang/p4app:stable</code> 改为 <code>p4lang/p4app:latest</code>。修改 <code>p4app</code> L16 为: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-P4APP_IMAGE=$&#123;P4APP_IMAGE:-p4lang/p4app:latest&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果没有安装 <a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">docker</a> ，需先安装。一键搞定：<code>wget -qO- https://get.docker.com/ | sh</code>。</p>
</li>
<li><p>为方便，建议把 <code>p4app</code> 脚本拷贝到 PATH 路径，例如：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp p4app /usr/local/bin</span><br></pre></td></tr></table></figure>
<p>程序安装到此结束！</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>p4app 运行以 <code>.p4app</code> 为后缀的目录，称 p4app 包。p4app 仓库中包含多个样例，例如 <code>simple_router.p4app</code>，运行方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p4app run examples/simple_router.p4app</span><br></pre></td></tr></table></figure>
<p>此样例最终进入 mininet 命令行，在此之前，p4app 进行如下处理：</p>
<ol>
<li>【首次运行 p4app 命令时】自动下载 docker 镜像 <code>p4lang/p4app:latest</code>，该镜像包含 P4 编译器、抓包工具 tshark、发包工具 scapy、net-tools 和 nmap 套件等工具</li>
<li>编译 <code>simper_router.p4</code></li>
<li>设置并启动一个容器做为软件交换机</li>
<li>设置并启动 mininet 模拟实验网络</li>
</ol>
<h2 id="p4app-命令参数"><a href="#p4app-命令参数" class="headerlink" title="p4app 命令参数"></a>p4app 命令参数</h2><ul>
<li>run，运行 p4app，可带 target 参数。</li>
<li>pack，压缩 p4app 包为单独文件，便于分享。使用 gzip 压缩</li>
<li>unpack，解压上述压缩包</li>
<li>update，更新 p4app 本地缓存的 P4 编译器和相关工具到最新版本。p4app 在本地缓存P4编译器和工具，因此不必每次都重新下载。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ ./p4app -h</span><br><span class="line">Usage:</span><br><span class="line">  p4app run &lt;program.p4app&gt;</span><br><span class="line">      Run a p4app.</span><br><span class="line">  p4app run &lt;program.p4app&gt; &lt;target&gt;</span><br><span class="line">      Run a p4app, specifying a target.</span><br><span class="line">  p4app pack &lt;program.p4app&gt;</span><br><span class="line">      Compress a p4app directory into a single file, in-place.</span><br><span class="line">  p4app unpack &lt;program.p4app&gt;</span><br><span class="line">      Expand a p4app file into a directory, in-place.</span><br><span class="line">  p4app update</span><br><span class="line">      Update the toolchain to the newest version.</span><br></pre></td></tr></table></figure>
<h3 id="target-与-backend"><a href="#target-与-backend" class="headerlink" title="target 与 backend"></a>target 与 backend</h3><p>p4app 包最终将怎么运行，由配置文件 manifest file <code>p4app.json</code> 的参数<code>targets</code> 指定。目前支持有多种运行方式，例如仅编译成 bmv2 目标、进行 stf 测试、mininet 单交换机测试、mininet 多交换机测试等。本文将这些运行方式称为 backend，一个 p4app 包可以有多个 target，每个 target 必须指定其 backend。</p>
<p>通过在 <code>p4app run</code> 时指定 target 运行非默认 target，例如运行 simple_counter.p4app 的 debug target：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p4app run examples/simple_couter.p4app debug</span><br></pre></td></tr></table></figure>
<p>如果有多个 target，且使用者没有通过名字指定默认 target，则 p4app 随机运行其中一个。可使用 <code>default-target</code> 选项，设置默认 backend。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;program&quot;: &quot;my_program.p4&quot;,</span><br><span class="line">  &quot;language&quot;: &quot;p4-14&quot;,</span><br><span class="line">  &quot;default-target&quot;: &quot;debug&quot;,</span><br><span class="line">  &quot;targets&quot;: &#123;</span><br><span class="line">    &quot;debug&quot;: &#123; &quot;use&quot;: &quot;mininet&quot;, &quot;num-hosts&quot;: 2 &#125;,</span><br><span class="line">    &quot;test1&quot;: &#123; &quot;use&quot;: &quot;stf&quot;, &quot;test&quot;: &quot;test1.stf&quot; &#125;,</span><br><span class="line">    &quot;test2&quot;: &#123; &quot;use&quot;: &quot;stf&quot;, &quot;test&quot;: &quot;test2.stf&quot; &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里定义一个名为 “debug” 的 mininet backend，以及两个 STF backend，分别名为 “test1” 和 “test2”。<code>&quot;user&quot;:&quot;mininet&quot;</code> 用于指明每个 target 使用哪个 backend，如果不使用 user 字段，则 target 名同时被认定为 backend 名。这也是为什么，在之前的样例中，不需要指明<code>&quot;use&quot;: &quot;mininet&quot;</code> ，因为 target 名就已经是 mininet，如果直接被用成 backend 名，p4app 也可以识别。</p>
<p>目前支持以下几种 backend，具体见后文详述。</p>
<ul>
<li>mininet</li>
<li>multiswitch</li>
<li>custom</li>
<li>stf</li>
<li>compile-bmv2</li>
</ul>
<h2 id="创建一个-p4app-包"><a href="#创建一个-p4app-包" class="headerlink" title="创建一个 p4app 包"></a>创建一个 p4app 包</h2><p>p4app 包的目录结构一般为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my_program.p4app</span><br><span class="line">  |</span><br><span class="line">  |- p4app.json</span><br><span class="line">  |</span><br><span class="line">  |- my_program.p4</span><br><span class="line">  |</span><br><span class="line">  |- ...other files...</span><br></pre></td></tr></table></figure>
<p><code>p4app.json</code>  是这个包的 manifest 文件，说明如何构建和运行 p4 程序，功能有点像 Makefile 文件。样例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;program&quot;: &quot;my_program.p4&quot;,</span><br><span class="line">  &quot;language&quot;: &quot;p4-14&quot;,</span><br><span class="line">  &quot;targets&quot;: &#123;</span><br><span class="line">    &quot;mininet&quot;: &#123;</span><br><span class="line">      &quot;num-hosts&quot;: 2,</span><br><span class="line">      &quot;switch-config&quot;: &quot;my_program.config&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>样例 manifest 告诉 p4app 应该运行 <code>my_program.p4</code>，该 p4 程序使用 <code>p4-14</code> 编写（同样也可以用 <code>p4-16</code>，P4-16 版本）。该样例定义一个 target，该 target 的 backend 为 <code>mininet</code>，同时提供一些 mininet 配置选项：测试网络有两个 host，一个模拟交换机，该交换机启机默认加载 <code>my_program.config</code> 中的配置。如果你在 <code>p4app.json</code> 中引用像 <code>my_program.config</code> 时，则需要将 <code>my_program.config</code> 文件包在 p4app 包中，p4app 将确保相应工具可找到它。</p>
<h2 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h2><h3 id="mininet"><a href="#mininet" class="headerlink" title="mininet"></a>mininet</h3><p>该后端编译 p4 程序，并加载到 BMv2 <a href="https://github.com/p4lang/behavioral-model/blob/master/docs/simple_switch.md" target="_blank" rel="noopener">simple_switch</a>，然后创建 mininet 实验环境。</p>
<p>支持以下配置值（皆为可选）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;mininet&quot;: &#123;</span><br><span class="line">  &quot;num-hosts&quot;: 2,</span><br><span class="line">  &quot;switch-config&quot;: &quot;file.config&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mininet 将创建星形拓扑网络，并创建 <code>num-hosts</code> 个数的 host，通过不同端口连接到模拟交换机。</p>
<p>模拟交换机的启机默认配置可通过 <code>switch-config</code> 配置。配置的文件是一系列 BMV2 <a href="https://github.com/p4lang/behavioral-model#using-the-cli-to-populate-tables" target="_blank" rel="noopener">simple_switch_CLI</a> 命令。</p>
<p>在启机过程中，有信息提示网络配置信息以及如何使用 logging 和 debugging 工具。</p>
<p>BMV2 debugger 很方便，<a href="https://github.com/p4lang/behavioral-model/blob/master/docs/p4dbg_user_guide.md" target="_blank" rel="noopener">这里</a> 阅读如何使用。</p>
<p>该 backend 还支持<code>compile-bmv2</code> 配置编译选项，详见下文相应章节。</p>
<h3 id="multiswitch"><a href="#multiswitch" class="headerlink" title="multiswitch"></a>multiswitch</h3><p>和 <code>mininet</code> 一样，这个 target 包含 P4 程序，并运行在 mininet 环境。但是这个 backend 支持配置多个交换机、自定义拓扑并在 host 上执行自定义命令。这些交换机默认自动配置 l2/l3 规则，用于所有 host 之间的互通，即假设 P4 程序有 <code>ipv4_lpm</code>、<code>send_frame</code> 和 <code>forward</code> 表，详见 simple_router.p4。</p>
<p>配置样例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&quot;multiswitch&quot;: &#123;</span><br><span class="line">  &quot;links&quot;: [</span><br><span class="line">    [&quot;h1&quot;, &quot;s1&quot;],</span><br><span class="line">    [&quot;s1&quot;, &quot;s2&quot;],</span><br><span class="line">    [&quot;s2&quot;, &quot;h2&quot;, 50]</span><br><span class="line">  ],</span><br><span class="line">  &quot;hosts&quot;: &#123;</span><br><span class="line">    &quot;h1&quot;: &#123;</span><br><span class="line">      &quot;cmd&quot;: &quot;python echo_server.py $port&quot;,</span><br><span class="line">      &quot;startup_sleep&quot;: 0.2,</span><br><span class="line">      &quot;wait&quot;: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;h2&quot;: &#123;</span><br><span class="line">      &quot;cmd&quot;: &quot;python echo_client.py h1 $port $echo_msg&quot;,</span><br><span class="line">      &quot;wait&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;port&quot;: 8000,</span><br><span class="line">    &quot;echo_msg&quot;: &quot;foobar&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该配置创建以下拓扑：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h1 &lt;---&gt; s1 &lt;---&gt; s2 &lt;---&gt; h2</span><br></pre></td></tr></table></figure>
<p>其中 <code>s2-h2</code> 链路人工配置 50ms 的延迟。host 配置选项：</p>
<ul>
<li><code>cmd</code> - 在 host 上运行的命令</li>
<li><code>wait</code> - 等待命令执行结束。如果配置成 false，表示在后台运行此命令。</li>
<li><code>startup_sleep</code> - 启动命令后应等待的时间（以秒为单位）。</li>
<li><code>latency</code> - 主机与交换机之间的延迟。配置值是数字（解释为秒）或具有时间单位的字符串（例如<code>50ms</code>或<code>1s</code>）。该配置将覆盖“links”对象中设置的延迟。</li>
</ul>
<p>通过将主机名（例如 “h1”）替换为相应的 IP 地址来格式化该命令。 目标中指定的参数将作为环境变量（即<code>$</code>后跟变量名称）可用于命令，详见 multiswitch 样例。</p>
<h4 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h4><p>目前每个 host 最多只能连一个 switch。</p>
<h4 id="指定每个交换机表项"><a href="#指定每个交换机表项" class="headerlink" title="指定每个交换机表项"></a>指定每个交换机表项</h4><p>路由表（<code>ipv4_lpm</code>，<code>send_frame</code> 和 <code>forward</code>）在本 target 中自动下发。使用者可根据自己的需要下发表项到每个交换机中，形式为包含一个命令文件或命令数组。这些自定义的表项优先级比路由表的自动生成的高。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&quot;multiswitch&quot;: &#123;</span><br><span class="line">  &quot;links&quot;: [ ... ],</span><br><span class="line">  &quot;hosts&quot;: &#123; ... &#125;,</span><br><span class="line">  &quot;switches&quot;: &#123;</span><br><span class="line">    &quot;s1&quot;: &#123;</span><br><span class="line">      &quot;entries&quot;: &quot;s1_commands.txt&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;s2&quot;: &#123;</span><br><span class="line">      &quot;entries&quot;: [</span><br><span class="line">        &quot;table_add ipv4_lpm set_nhop 10.0.1.10/32 =&gt; 10.0.1.10 1&quot;,</span><br><span class="line">        &quot;table_add ipv4_lpm set_nhop 10.0.2.10/32 =&gt; 10.0.2.10 2&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果上述 <code>s2</code> 表项与自动生成的表项一样（例如自动生成的表项 <code>set_nhop 10.0.1.10 / 32</code>），这些自定义表项将具有更高的优先权，在下发表项时将警告表项重复。</p>
<h4 id="自定义拓扑类"><a href="#自定义拓扑类" class="headerlink" title="自定义拓扑类"></a>自定义拓扑类</h4><p>通过 <code>topo_module</code> 选项指定自己的 mininet 拓扑类。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;multiswitch&quot;: &#123;</span><br><span class="line">  ...</span><br><span class="line">  &quot;topo_module&quot;: &quot;mytopo&quot;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这将 import <code>mytopo</code> 模块 <code>mytopo.py</code>，该文件应与 manifest 文件（<code>p4app.json</code>）放在同一目录下，同时应实现 <code>CustomAppTopo</code> 类。可 extend 默认的 topo 类 <a href="https://github.com/p4lang/p4app/blob/master/docker/scripts/mininet/apptopo.py" target="_blank" rel="noopener">apptopo.AppTopo</a>。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># mytopo.py</span><br><span class="line">from apptopo import AppTopo</span><br><span class="line"></span><br><span class="line">class CustomAppTopo(AppTopo):</span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        AppTopo.__init__(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        print self.links()</span><br></pre></td></tr></table></figure>
<p>详见样例 <a href="https://github.com/p4lang/p4app/blob/master/examples/customtopo.p4app/mytopo.py" target="_blank" rel="noopener">customtopo.p4app</a>。</p>
<h4 id="自定义控制器"><a href="#自定义控制器" class="headerlink" title="自定义控制器"></a>自定义控制器</h4><p>类似 <code>topo_module</code> 选项，通过 <code>controller_module</code> 选项自定义控制器。该模块应实现 <code>CustomAppController</code> 类。默认的控制器类为 <a href="https://github.com/p4lang/p4app/blob/master/docker/scripts/mininet/appcontroller.py" target="_blank" rel="noopener">appcontroller.AppController</a>，可直接对该类进行扩展。详见样例 <a href="https://github.com/p4lang/p4app/blob/master/examples/customtopo.p4app/mycontroller.py" target="_blank" rel="noopener">customtopo.p4app</a>。</p>
<h4 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h4><p>当本 target 运行时，host 上的临时目录 <code>/tmp/p4app_log</code> 将加载到 guest 的 <code>/tmp/p4app_log</code>。运行 p4app 后， host 上保存有所有的 log。 host 命令的标准输出 stdout 将保存在该目录，如果需要保存某个命令的 log，将可以将其输出到该目录。</p>
<p>设置 <code>&quot;bmv2_log&quot;:true</code>，保存 P4 交换机的调试 log。<br>设置 <code>&quot;pcap_dump&quot;:true</code>，抓取所有交换机的报文，交保存为 PCAP 格式。</p>
<p>以上文件将被保存到 <code>/tmp/p4app_log</code>。详见样例 <a href="https://github.com/p4lang/p4app/blob/master/examples/broadcast.p4app/p4app.json" target="_blank" rel="noopener">broadcast.p4app</a> </p>
<h4 id="Cleanup-commands"><a href="#Cleanup-commands" class="headerlink" title="Cleanup commands"></a>Cleanup commands</h4><p>运行 target 后（在 mininet stop 之前），如果需要在 docker 容器内执行命令，可使用 <code>after</code> 选项，其后必须包含 <code>cmd</code>，可以是一个或多个命令，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;multiswitch&quot;: &#123;</span><br><span class="line">  &quot;links&quot;: [ ... ],</span><br><span class="line">  &quot;hosts&quot;: &#123; ... &#125;,</span><br><span class="line">  &quot;after&quot;: &#123;</span><br><span class="line">    &quot;cmd&quot;: [</span><br><span class="line">      &quot;echo register_read my_register 1 | simple_switch_CLI --json p4src/my_router.p4.json&quot;,</span><br><span class="line">      &quot;echo register_read my_register 2 | simple_switch_CLI --json p4src/my_router.p4.json&quot;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="custom"><a href="#custom" class="headerlink" title="custom"></a>custom</h3><p>该 backend 允许使用者指定 python <code>program</code>，该 <code>program</code> 使用 Mininet python API 指定网络拓扑和配置。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;program&quot;: &quot;source_routing.p4&quot;,</span><br><span class="line">  &quot;language&quot;: &quot;p4-14&quot;,</span><br><span class="line">  &quot;targets&quot;: &#123;</span><br><span class="line">      &quot;custom&quot;: &#123;</span><br><span class="line">	       &quot;program&quot;: &quot;topo.py&quot;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该 target 在启动 Mninet 时运行 <code>topy.py</code> 脚本。将使用以下参数调用 <code>program</code>：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>–behavioral-exe</td>
<td>switch 可执行文件</td>
</tr>
<tr>
<td>–json</td>
<td>P4 程序编译结果</td>
</tr>
<tr>
<td>–cli</td>
<td>switch_CLI 命令</td>
</tr>
</tbody>
</table>
<p>样例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PYTHONPATH=$PYTHONPATH:/scripts/mininet/ python2 topo.py \</span><br><span class="line">                        --behavioral-exe simple_switch \</span><br><span class="line">                        --json SOME_FILE \</span><br><span class="line">                        --cli simple_switch_CLI</span><br></pre></td></tr></table></figure>
<p>同时可以指定其他参数传递给自定义拓扑程序，方法是将它们包含在 <code>program</code> 定义中，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;program&quot;: &quot;source_routing.p4&quot;,</span><br><span class="line">  &quot;language&quot;: &quot;p4-14&quot;,</span><br><span class="line">  &quot;targets&quot;: &#123;</span><br><span class="line">      &quot;custom&quot;: &#123;</span><br><span class="line">	       &quot;program&quot;: &quot;topo.py --num-hosts 2 --switch-config simple_router.config&quot;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>program</code> 可通过 <code>HOSTNAME</code> 变量获取 docker 容器 ID。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">container = os.environ[<span class="string">'HOSTNAME'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Run the switch CLI as follows:'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'  docker exec -t -i %s %s'</span> % (container, args.cli)</span><br></pre></td></tr></table></figure>
<h3 id="stf"><a href="#stf" class="headerlink" title="stf"></a>stf</h3><p>stf 后端编译给定的 p4 程序，并运行 stf 测试用例。</p>
<p>stf，simple testing framework，一种模拟网络测试框架。</p>
<blockquote>
<p>“simple testing framework”, which can help you test small P4 programs and ensure they behave the way you expect.</p>
</blockquote>
<p><code>simple_counter.p4app</code> 样例使用 stf 测试框架，运行该样例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p4app run examples/simple_counter.p4app</span><br></pre></td></tr></table></figure>
<p>运行后，p4app 启动 docker 容器，并在容器中：</p>
<ul>
<li>自动编译 <code>simple_counter.p4</code></li>
<li>运行 simple_switch 交换机</li>
<li>stf 下发默认表项</li>
<li>stf 发送定义在 <code>simple_counter.stf</code> 中的报文，并验证 simple_switch 是否转发出预期的报文</li>
</ul>
<p>和 mininet 不一样的是， stf 最终直接退出。</p>
<h4 id="simple-counter-p4app-stf-配置"><a href="#simple-counter-p4app-stf-配置" class="headerlink" title="simple_counter.p4app stf 配置"></a>simple_counter.p4app stf 配置</h4><ul>
<li><code>p4app.json</code> 配置</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"program"</span>: <span class="string">"simple_counter.p4"</span>,</span><br><span class="line">  <span class="attr">"language"</span>: <span class="string">"p4-14"</span>,</span><br><span class="line">  <span class="attr">"targets"</span>: &#123;</span><br><span class="line">    <span class="attr">"stf"</span>: &#123;</span><br><span class="line">      <span class="attr">"test"</span>: <span class="string">"simple_counter.stf"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"debug"</span>: &#123;</span><br><span class="line">      <span class="attr">"use"</span>: <span class="string">"mininet"</span>,</span><br><span class="line">      <span class="attr">"num-hosts"</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="attr">"switch-config"</span>: <span class="string">"simple_counter.config"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>stf 文件 simple_counter.stf 配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">add test1 data.f1:0x01010101 c1_2(val1:0x01, val2:0x02)</span><br><span class="line">add test1 data.f1:0x02020202 c1_2(val1:0x10, val2:0x20)</span><br><span class="line"></span><br><span class="line">add test2 data.f2:0x03030303 c3_4(val3:0x03, val4:0x04, port:1)</span><br><span class="line">add test2 data.f2:0x04040404 c3_4(val3:0x30, val4:0x40, port:2)</span><br><span class="line"></span><br><span class="line">expect 1 01010101 03030303 01 02 03 04</span><br><span class="line">packet 0 01010101 03030303 55 66 77 88</span><br><span class="line">expect 2 01010101 04040404 01 02 30 40</span><br><span class="line">packet 0 01010101 04040404 55 66 77 88</span><br><span class="line">expect 1 02020202 03030303 10 20 03 04</span><br><span class="line">packet 0 02020202 03030303 99 88 77 66</span><br><span class="line">expect 2 02020202 04040404 10 20 30 40</span><br><span class="line">packet 0 02020202 04040404 14 25 36 47</span><br></pre></td></tr></table></figure>
<p>必须使用 stf 格式编写 stf target 指定的配置文件，目前还没有该格式的说明文档。（如果您想反向工程并提供一些文档，请提交PR！）请参阅 p4app 相关样例，参考其中的基本用法。</p>
<p>此后端还支持 <code>compile-bmv2</code> target 的配置值。</p>
<h3 id="compile-bmv2"><a href="#compile-bmv2" class="headerlink" title="compile-bmv2"></a>compile-bmv2</h3><p>一个简单的后端，将 p4 程序编译成 BMV2 目标。</p>
<p>支持以下可选配置值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;compile-bmv2&quot;: &#123;</span><br><span class="line">  &quot;compiler-flags&quot;: [&quot;-v&quot;, &quot;-E&quot;],</span><br><span class="line">  &quot;run-before-compile&quot;: [&quot;date&quot;],</span><br><span class="line">  &quot;run-after-compile&quot;: [&quot;date&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2><h3 id="指定-docker-image"><a href="#指定-docker-image" class="headerlink" title="指定 docker image"></a>指定 docker image</h3><p>如果想使用自定义的 P4 工具链或 p4app，可通过 <code>P4APP_IMAGE</code> 环境变量配置 Docker image，替代标准 p4lang image。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P4APP_IMAGE=me/my_p4app_image:latest p4app run examples/simple_router.p4app</span><br></pre></td></tr></table></figure>
<h3 id="指定-manifest-文件"><a href="#指定-manifest-文件" class="headerlink" title="指定 manifest 文件"></a>指定 manifest 文件</h3><p>默认情况下，p4app 使用 app 目录下一个名为 <code>p4app.json</code> 的 manifest 文件。如果你的 manifest 文件名称不是 <code>p4app.json</code>，则可通过 <code>--manifest</code> 选项指定 manifest 文件。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p4app run myapp.p4app --manifest testing.p4app</span><br></pre></td></tr></table></figure>
<h3 id="指定-log-目录"><a href="#指定-log-目录" class="headerlink" title="指定 log 目录"></a>指定 log 目录</h3><p>默认情况下，p4app 挂载 host 目录 <code>/tmp/p4app_logs</code> 到 docker 容器 guest 目录 <code>/tmp/p4app_logs</code>。bmv2 以及其他程序的输出将保存在此目录。可通过 <code>$P4APP_LOGDIR</code> 环境变量指定其他目录为 log 目录，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P4APP_LOGDIR=./out p4app run myapp.p4app</span><br></pre></td></tr></table></figure>
<h2 id="运行-log-汇总"><a href="#运行-log-汇总" class="headerlink" title="运行 log 汇总"></a>运行 log 汇总</h2><h3 id="运行-simple-router-p4app"><a href="#运行-simple-router-p4app" class="headerlink" title="运行 simple_router.p4app"></a>运行 simple_router.p4app</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ sudo cp p4app /usr/local/bin/</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ p4app run examples/simple_router.p4app/</span><br><span class="line">Unable to find image &apos;p4lang/p4app:latest&apos; locally</span><br><span class="line">latest: Pulling from p4lang/p4app</span><br><span class="line">c62795f78da9: Already exists </span><br><span class="line">d4fceeeb758e: Already exists </span><br><span class="line">5c9125a401ae: Already exists </span><br><span class="line">0062f774e994: Already exists </span><br><span class="line">6b33fd031fac: Already exists </span><br><span class="line">c0bc589d658e: Pull complete </span><br><span class="line">d304998c3f88: Pull complete </span><br><span class="line">9a10b2f1580d: Pull complete </span><br><span class="line">0f3b81cccf80: Pull complete </span><br><span class="line">d32e2c3a5556: Pull complete </span><br><span class="line">421d6ade42fb: Pull complete </span><br><span class="line">ed336ba6d94a: Pull complete </span><br><span class="line">15d9b8c3dfdb: Pull complete </span><br><span class="line">d7df888c0624: Pull complete </span><br><span class="line">09b889a34f73: Pull complete </span><br><span class="line">8e46ef6cc28e: Pull complete </span><br><span class="line">53625fe57a43: Pull complete </span><br><span class="line">a1cfe7751ecf: Pull complete </span><br><span class="line">098b357129cf: Pull complete </span><br><span class="line">ecb46f207e83: Pull complete </span><br><span class="line">25df5d0fdf2a: Pull complete </span><br><span class="line">a2592a836f76: Pull complete </span><br><span class="line">ba5f1dc63b79: Pull complete </span><br><span class="line">d8fe27124ef4: Pull complete </span><br><span class="line">b6c4e12d947a: Pull complete </span><br><span class="line">24342178e654: Pull complete </span><br><span class="line">21146199f8e0: Pull complete </span><br><span class="line">41e02212e6ab: Pull complete </span><br><span class="line">885ba0b6073a: Pull complete </span><br><span class="line">28805cf1e6e6: Pull complete </span><br><span class="line">d5f002ec605e: Pull complete </span><br><span class="line">07b6dd17ef27: Pull complete </span><br><span class="line">b91909b6c11f: Pull complete </span><br><span class="line">f0f07a64cc7e: Pull complete </span><br><span class="line">202436ed05da: Pull complete </span><br><span class="line">Digest: sha256:7d8a140c7160992f693b9d5fab08f7aeaacdb448050d17da81c4ae05dd5465d0</span><br><span class="line">Status: Downloaded newer image for p4lang/p4app:latest</span><br><span class="line">Entering build directory.</span><br><span class="line">Extracting package.</span><br><span class="line">Reading package manifest.</span><br><span class="line">&gt; p4c-bm2-ss --p4v 16 &quot;simple_router.p4&quot; -o &quot;simple_router.p4.json&quot;</span><br><span class="line">&gt; python2 &quot;/scripts/mininet/single_switch_mininet.py&quot; --log-file &quot;/var/log/simple_router.p4.log&quot; --cli-message &quot;mininet_message.txt&quot; --num-hosts 2 --switch-config &quot;simple_router.config&quot; --behavioral-exe &quot;simple_switch&quot; --json &quot;simple_router.p4.json&quot;</span><br><span class="line">Adding host h1</span><br><span class="line">Adding host h2</span><br><span class="line">*** Error setting resource limits. Mininet&apos;s performance may be affected.</span><br><span class="line">*** Creating network</span><br><span class="line">*** Adding hosts:</span><br><span class="line">h1 h2 </span><br><span class="line">*** Adding switches:</span><br><span class="line">s1 </span><br><span class="line">*** Adding links:</span><br><span class="line">(h1, s1) (h2, s1) </span><br><span class="line">*** Configuring hosts</span><br><span class="line">h1 h2 </span><br><span class="line">*** Starting controller</span><br><span class="line"></span><br><span class="line">*** Starting 1 switches</span><br><span class="line">s1 Starting P4 switch s1.</span><br><span class="line">simple_switch -i 1@s1-eth1 -i 2@s1-eth2 --thrift-port 9090 --nanolog ipc:///tmp/bm-0-log.ipc --device-id 0 simple_router.p4.json --debugger --log-console</span><br><span class="line">P4 switch s1 has been started.</span><br><span class="line"></span><br><span class="line">**********</span><br><span class="line">Network configuration for: h1</span><br><span class="line">Default interface: h1-eth0	10.0.0.10	00:04:00:00:00:00</span><br><span class="line">Default route to switch: 10.0.0.1 (00:aa:bb:00:00:00)</span><br><span class="line">**********</span><br><span class="line">**********</span><br><span class="line">Network configuration for: h2</span><br><span class="line">Default interface: h2-eth0	10.0.1.10	00:04:00:00:00:01</span><br><span class="line">Default route to switch: 10.0.1.1 (00:aa:bb:00:00:01)</span><br><span class="line">**********</span><br><span class="line"></span><br><span class="line">Reading switch configuration script: simple_router.config</span><br><span class="line">Configuring switch...</span><br><span class="line">Obtaining JSON from switch...</span><br><span class="line">Done</span><br><span class="line">Control utility for runtime P4 table manipulation</span><br><span class="line">RuntimeCmd: Setting default action of send_frame</span><br><span class="line">action:              _drop</span><br><span class="line">runtime data:        </span><br><span class="line">RuntimeCmd: Setting default action of forward</span><br><span class="line">action:              _drop</span><br><span class="line">runtime data:        </span><br><span class="line">RuntimeCmd: Setting default action of ipv4_lpm</span><br><span class="line">action:              _drop</span><br><span class="line">runtime data:        </span><br><span class="line">RuntimeCmd: Adding entry to exact match table send_frame</span><br><span class="line">match key:           EXACT-00:01</span><br><span class="line">action:              rewrite_mac</span><br><span class="line">runtime data:        00:aa:bb:00:00:00</span><br><span class="line">Entry has been added with handle 0</span><br><span class="line">RuntimeCmd: Adding entry to exact match table send_frame</span><br><span class="line">match key:           EXACT-00:02</span><br><span class="line">action:              rewrite_mac</span><br><span class="line">runtime data:        00:aa:bb:00:00:01</span><br><span class="line">Entry has been added with handle 1</span><br><span class="line">RuntimeCmd: Adding entry to exact match table forward</span><br><span class="line">match key:           EXACT-0a:00:00:0a</span><br><span class="line">action:              set_dmac</span><br><span class="line">runtime data:        00:04:00:00:00:00</span><br><span class="line">Entry has been added with handle 0</span><br><span class="line">RuntimeCmd: Adding entry to exact match table forward</span><br><span class="line">match key:           EXACT-0a:00:01:0a</span><br><span class="line">action:              set_dmac</span><br><span class="line">runtime data:        00:04:00:00:00:01</span><br><span class="line">Entry has been added with handle 1</span><br><span class="line">RuntimeCmd: Adding entry to lpm match table ipv4_lpm</span><br><span class="line">match key:           LPM-0a:00:00:0a/32</span><br><span class="line">action:              set_nhop</span><br><span class="line">runtime data:        0a:00:00:0a	00:01</span><br><span class="line">Entry has been added with handle 0</span><br><span class="line">RuntimeCmd: Adding entry to lpm match table ipv4_lpm</span><br><span class="line">match key:           LPM-0a:00:01:0a/32</span><br><span class="line">action:              set_nhop</span><br><span class="line">runtime data:        0a:00:01:0a	00:02</span><br><span class="line">Entry has been added with handle 1</span><br><span class="line">RuntimeCmd: </span><br><span class="line">Configuration complete.</span><br><span class="line"></span><br><span class="line">Ready !</span><br><span class="line"></span><br><span class="line">======================================================================</span><br><span class="line">Welcome to the BMV2 Mininet CLI!</span><br><span class="line">======================================================================</span><br><span class="line">Your P4 program is installed into the BMV2 software switch</span><br><span class="line">and your initial configuration is loaded. You can interact</span><br><span class="line">with the network using the mininet CLI below.</span><br><span class="line"></span><br><span class="line">To inspect or change the switch configuration, connect to</span><br><span class="line">its CLI from your host operating system using this command:</span><br><span class="line">  docker exec -t -i 66d97e58a61f simple_switch_CLI</span><br><span class="line"></span><br><span class="line">To view the switch log, run this command from your host OS:</span><br><span class="line">  docker exec -t -i 66d97e58a61f tail -f /var/log/simple_router.p4.log</span><br><span class="line"></span><br><span class="line">To run the switch debugger, run this command from your host OS:</span><br><span class="line">  docker exec -t -i 66d97e58a61f bm_p4dbg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*** Starting CLI:</span><br><span class="line">mininet&gt; h1 ping h2</span><br><span class="line">PING 10.0.1.10 (10.0.1.10) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.0.1.10: icmp_seq=1 ttl=63 time=1.42 ms</span><br><span class="line">64 bytes from 10.0.1.10: icmp_seq=2 ttl=63 time=1.65 ms</span><br><span class="line">^C</span><br><span class="line">--- 10.0.1.10 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span><br><span class="line">rtt min/avg/max/mdev = 1.421/1.540/1.659/0.119 ms</span><br><span class="line">mininet&gt; </span><br><span class="line">mininet&gt; </span><br><span class="line">mininet&gt; exit</span><br><span class="line">*** Stopping 0 controllers</span><br><span class="line"></span><br><span class="line">*** Stopping 2 links</span><br><span class="line">..</span><br><span class="line">*** Stopping 1 switches</span><br><span class="line">s1 </span><br><span class="line">*** Stopping 2 hosts</span><br><span class="line">h1 h2 </span><br><span class="line">*** Done</span><br></pre></td></tr></table></figure>
<h3 id="运行-simple-counter-p4app"><a href="#运行-simple-counter-p4app" class="headerlink" title="运行 simple_counter.p4app"></a>运行 simple_counter.p4app</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ p4app run examples/simple_counter.p4app/</span><br><span class="line">Entering build directory.</span><br><span class="line">Extracting package.</span><br><span class="line">Reading package manifest.</span><br><span class="line">&gt; p4c-bm2-ss --p4v 14 &quot;simple_counter.p4&quot; -o &quot;simple_counter.p4.json&quot;</span><br><span class="line">warning: cnt: Direct counter not used; ignoring</span><br><span class="line">&gt; python2 &quot;/scripts/stf/bmv2stf.py&quot; -v /tmp/simple_counter.p4.json /tmp/simple_counter.stf</span><br><span class="line">WARNING: No route found for IPv6 destination :: (no default route?)</span><br><span class="line">Running model</span><br><span class="line">Running simple_switch --log-file switch.log --log-flush --use-files 0 --thrift-port 9232 --device-id 142 -i 0@pcap0 -i 1@pcap1 -i 2@pcap2 /tmp/simple_counter.p4.json</span><br><span class="line">Calling target program-options parser</span><br><span class="line">Adding interface pcap0 as port 0 (files)</span><br><span class="line">Adding interface pcap1 as port 1 (files)</span><br><span class="line">Adding interface pcap2 as port 2 (files)</span><br><span class="line">Running simple_switch_CLI --thrift-port 9232</span><br><span class="line">Thrift server was started</span><br><span class="line">STF Command: </span><br><span class="line">STF Command: add test1 data.f1:0x01010101 c1_2(val1:0x01, val2:0x02)</span><br><span class="line">table_add test1 c1_2 0x01010101 =&gt; 0x01 0x02</span><br><span class="line">STF Command: add test1 data.f1:0x02020202 c1_2(val1:0x10, val2:0x20)</span><br><span class="line">table_add test1 c1_2 0x02020202 =&gt; 0x10 0x20</span><br><span class="line">STF Command: </span><br><span class="line">STF Command: add test2 data.f2:0x03030303 c3_4(val3:0x03, val4:0x04, port:1)</span><br><span class="line">table_add test2 c3_4 0x03030303 =&gt; 0x03 0x04 1</span><br><span class="line">STF Command: add test2 data.f2:0x04040404 c3_4(val3:0x30, val4:0x40, port:2)</span><br><span class="line">table_add test2 c3_4 0x04040404 =&gt; 0x30 0x40 2</span><br><span class="line">STF Command: </span><br><span class="line">STF Command: expect 1 01010101 03030303 01 02 03 04</span><br><span class="line">STF Command: packet 0 01010101 03030303 55 66 77 88</span><br><span class="line">Obtaining JSON from switch...</span><br><span class="line">Done</span><br><span class="line">Control utility for runtime P4 table manipulation</span><br><span class="line">RuntimeCmd: Adding entry to exact match table test1</span><br><span class="line">match key:           EXACT-01:01:01:01</span><br><span class="line">action:              c1_2</span><br><span class="line">runtime data:        01 02</span><br><span class="line">Entry has been added with handle 0</span><br><span class="line">RuntimeCmd: Adding entry to exact match table test1</span><br><span class="line">match key:           EXACT-02:02:02:02</span><br><span class="line">action:              c1_2</span><br><span class="line">runtime data:        10 20</span><br><span class="line">Entry has been added with handle 1</span><br><span class="line">RuntimeCmd: Adding entry to exact match table test2</span><br><span class="line">match key:           EXACT-03:03:03:03</span><br><span class="line">action:              c3_4</span><br><span class="line">runtime data:        03 04      00:01</span><br><span class="line">Entry has been added with handle 0</span><br><span class="line">RuntimeCmd: Adding entry to exact match table test2</span><br><span class="line">match key:           EXACT-04:04:04:04</span><br><span class="line">action:              c3_4</span><br><span class="line">runtime data:        30 40      00:02</span><br><span class="line">Entry has been added with handle 1</span><br><span class="line">STF Command: expect 2 01010101 04040404 01 02 30 40</span><br><span class="line">STF Command: packet 0 01010101 04040404 55 66 77 88</span><br><span class="line">STF Command: expect 1 02020202 03030303 10 20 03 04</span><br><span class="line">STF Command: packet 0 02020202 03030303 99 88 77 66</span><br><span class="line">STF Command: expect 2 02020202 04040404 10 20 30 40</span><br><span class="line">STF Command: packet 0 02020202 04040404 14 25 36 47</span><br><span class="line">RuntimeCmd: </span><br><span class="line">simple_switch exit code -15</span><br><span class="line">Execution completed</span><br><span class="line">Comparing outputs</span><br><span class="line">WARNING: PcapReader: unknown LL type [0]/[0x0]. Using Raw packets</span><br><span class="line">WARNING: PcapReader: unknown LL type [0]/[0x0]. Using Raw packets</span><br><span class="line">SUCCESS</span><br></pre></td></tr></table></figure>
<h3 id="pack-amp-unpack-样例-log"><a href="#pack-amp-unpack-样例-log" class="headerlink" title="pack &amp; unpack 样例 log"></a>pack &amp; unpack 样例 log</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ ls multiswitch.p4app/</span><br><span class="line">echo_client.py  echo_server.py  header.p4  p4app.json  parser.p4  simple_router.p4</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ p4app pack multiswitch.p4app/  </span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ ls</span><br><span class="line">broadcast.p4app     customtopo.p4app   multiswitch.p4app     simple_counter.p4app  source_routing.p4app</span><br><span class="line">compile_only.p4app  multi_iface.p4app  paxos_acceptor.p4app  simple_router.p4app</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ file multiswitch.p4app </span><br><span class="line">multiswitch.p4app: gzip compressed data, last modified: Mon May 29 08:25:21 2017, from Unix</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ p4app unpack multiswitch.p4app </span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ ls multiswitch.p4app/</span><br><span class="line">echo_client.py  echo_server.py  header.p4  p4app.json  parser.p4  simple_router.p4</span><br></pre></td></tr></table></figure>
<h3 id="compile-bmv2-backend-样例"><a href="#compile-bmv2-backend-样例" class="headerlink" title="compile-bmv2 backend 样例"></a>compile-bmv2 backend 样例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ p4app run examples/compile_only.p4app/</span><br><span class="line">Entering build directory.</span><br><span class="line">Extracting package.</span><br><span class="line">Reading package manifest.</span><br><span class="line">&gt; p4c-bm2-ss --p4v 14 -v --p4runtime-file out.bin --p4runtime-as-json &quot;compile_only.p4&quot; -o &quot;compile_only.p4.json&quot;</span><br><span class="line">error: Unknown option --p4runtime-as-json</span><br><span class="line">p4c-bm2-ss: Compile a P4 program</span><br><span class="line">--help                                  Print this help message</span><br><span class="line">--version                               Print compiler version</span><br><span class="line">-I path                                 Specify include path (passed to preprocessor)</span><br><span class="line">-D arg=value                            Define macro (passed to preprocessor)</span><br><span class="line">-U arg                                  Undefine macro (passed to preprocessor)</span><br><span class="line">-E                                      Preprocess only, do not compile (prints program on stdout)</span><br><span class="line">--nocpp                                 Skip preprocess, assume input file is already preprocessed.</span><br><span class="line">--p4v &#123;14|16&#125;                           Specify language version to compile</span><br><span class="line">--target target                         Compile for the specified target</span><br><span class="line">--pp file                               Pretty-print the program in the specified file.</span><br><span class="line">--toJSON file                           Dump IR to JSON in the specified file.</span><br><span class="line">--testJson                              Dump and undump the IR</span><br><span class="line">--p4runtime-file file                   Write a P4Runtime control plane API description to the specified file.</span><br><span class="line">--p4runtime-format &#123;binary,json,text&#125;   Choose output format for the P4Runtime API description (default is binary).</span><br><span class="line">-o outfile                              Write output to outfile</span><br><span class="line">--Werror                                Treat all warnings as errors</span><br><span class="line">-T loglevel                             [Compiler debugging] Adjust logging level per file (see below)</span><br><span class="line">-v                                      [Compiler debugging] Increase verbosity level (can be repeated)</span><br><span class="line">--top4 pass1[,pass2]                    [Compiler debugging] Dump the P4 representation after</span><br><span class="line">                                        passes whose name contains one of `passX&apos; substrings.</span><br><span class="line">                                        When &apos;-v&apos; is used this will include the compiler IR.</span><br><span class="line">--dump folder                           [Compiler debugging] Folder where P4 programs are dumped</span><br><span class="line">loglevel format is:</span><br><span class="line">  sourceFile:level,...,sourceFile:level</span><br><span class="line">where &apos;sourceFile&apos; is a compiler source file and</span><br><span class="line">&apos;level&apos; is the verbosity level for LOG messages in that file</span><br><span class="line">&gt; cat out.bin</span><br><span class="line">cat: out.bin: No such file or directory</span><br><span class="line">Compile failed.</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ vi examples/compile_only.p4app/p4app.json</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ </span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ p4app run examples/compile_only.p4app/</span><br><span class="line">Entering build directory.</span><br><span class="line">Extracting package.</span><br><span class="line">Reading package manifest.</span><br><span class="line">&gt; p4c-bm2-ss --p4v 14 -v --p4runtime-file out.bin --p4runtime-format json &quot;compile_only.p4&quot; -o &quot;compile_only.p4.json&quot;</span><br><span class="line">Invoking preprocessor </span><br><span class="line">cpp -C -undef -nostdinc  -D__TARGET_BMV2__ -I/usr/local/share/p4c/p4_14include compile_only.p4</span><br><span class="line">Invoking preprocessor </span><br><span class="line">cpp -C -undef -nostdinc  -I/usr/local/share/p4c/p4include /usr/local/share/p4c/p4include/v1model.p4</span><br><span class="line">Parsing P4-16 program /usr/local/share/p4c/p4include/v1model.p4</span><br><span class="line">Parsing P4-14 program compile_only.p4</span><br><span class="line">Converting to P4-16</span><br><span class="line">Converter_0_DoConstantFolding</span><br><span class="line">Converter_1_CheckHeaderTypes</span><br><span class="line">Converter_2_TypeCheck</span><br><span class="line">Converter_3_DiscoverStructure</span><br><span class="line">Converter_4_ComputeCallGraph</span><br><span class="line">Converter_5_Rewriter</span><br><span class="line">Converter_6_FixExtracts</span><br><span class="line">FrontEnd_0_PrettyPrint</span><br><span class="line">FrontEnd_1_ValidateParsedProgram</span><br><span class="line">FrontEnd_2_CreateBuiltins</span><br><span class="line">FrontEnd_3_ResolveReferences</span><br><span class="line">FrontEnd_4_ConstantFolding</span><br><span class="line">FrontEnd_5_InstantiateDirectCalls</span><br><span class="line">FrontEnd_6_ResolveReferences</span><br><span class="line">FrontEnd_7_TypeInference</span><br><span class="line">FrontEnd_8_BindTypeVariables</span><br><span class="line">FrontEnd_9_ClearTypeMap</span><br><span class="line">FrontEnd_10_TableKeyNames</span><br><span class="line">FrontEnd_11_ConstantFolding</span><br><span class="line">FrontEnd_12_StrengthReduction</span><br><span class="line">FrontEnd_13_UselessCasts</span><br><span class="line">FrontEnd_14_SimplifyControlFlow</span><br><span class="line">FrontEnd_15_FrontEndDump</span><br><span class="line">FrontEnd_16_RemoveAllUnusedDeclarations</span><br><span class="line">FrontEnd_17_SimplifyParsers</span><br><span class="line">FrontEnd_18_ResetHeaders</span><br><span class="line">FrontEnd_19_UniqueNames</span><br><span class="line">FrontEnd_20_MoveDeclarations</span><br><span class="line">FrontEnd_21_MoveInitializers</span><br><span class="line">FrontEnd_22_SideEffectOrdering</span><br><span class="line">FrontEnd_23_SetHeaders</span><br><span class="line">FrontEnd_24_SimplifyControlFlow</span><br><span class="line">FrontEnd_25_MoveDeclarations</span><br><span class="line">FrontEnd_26_SimplifyDefUse</span><br><span class="line">FrontEnd_27_UniqueParameters</span><br><span class="line">FrontEnd_28_SimplifyControlFlow</span><br><span class="line">FrontEnd_29_SpecializeAll</span><br><span class="line">FrontEnd_30_RemoveParserControlFlow</span><br><span class="line">FrontEnd_31_FrontEndLast</span><br><span class="line">MidEnd_0_ConvertEnums</span><br><span class="line">MidEnd_1_VisitFunctor</span><br><span class="line">MidEnd_2_RemoveReturns</span><br><span class="line">MidEnd_3_MoveConstructors</span><br><span class="line">MidEnd_4_RemoveAllUnusedDeclarations</span><br><span class="line">MidEnd_5_ClearTypeMap</span><br><span class="line">MidEnd_6_Evaluator</span><br><span class="line">MidEnd_7_VisitFunctor</span><br><span class="line">MidEnd_8_Inline</span><br><span class="line">MidEnd_9_InlineActions</span><br><span class="line">MidEnd_10_LocalizeAllActions</span><br><span class="line">MidEnd_11_UniqueNames</span><br><span class="line">MidEnd_12_UniqueParameters</span><br><span class="line">MidEnd_13_SimplifyControlFlow</span><br><span class="line">MidEnd_14_RemoveActionParameters</span><br><span class="line">MidEnd_15_SimplifyKey</span><br><span class="line">MidEnd_16_ConstantFolding</span><br><span class="line">MidEnd_17_StrengthReduction</span><br><span class="line">MidEnd_18_SimplifySelectCases</span><br><span class="line">MidEnd_19_ExpandLookahead</span><br><span class="line">MidEnd_20_SimplifyParsers</span><br><span class="line">MidEnd_21_StrengthReduction</span><br><span class="line">MidEnd_22_EliminateTuples</span><br><span class="line">MidEnd_23_CopyStructures</span><br><span class="line">MidEnd_24_NestedStructs</span><br><span class="line">MidEnd_25_SimplifySelectList</span><br><span class="line">MidEnd_26_RemoveSelectBooleans</span><br><span class="line">MidEnd_27_Predication</span><br><span class="line">MidEnd_28_MoveDeclarations</span><br><span class="line">MidEnd_29_ConstantFolding</span><br><span class="line">MidEnd_30_LocalCopyPropagation</span><br><span class="line">MidEnd_31_ConstantFolding</span><br><span class="line">MidEnd_32_MoveDeclarations</span><br><span class="line">MidEnd_33_ValidateTableProperties</span><br><span class="line">MidEnd_34_SimplifyControlFlow</span><br><span class="line">MidEnd_35_CompileTimeOperations</span><br><span class="line">MidEnd_36_TableHit</span><br><span class="line">MidEnd_37_SynthesizeActions</span><br><span class="line">MidEnd_38_MoveActionsToTables</span><br><span class="line">MidEnd_39_TypeChecking</span><br><span class="line">MidEnd_40_SimplifyControlFlow</span><br><span class="line">MidEnd_41_RemoveLeftSlices</span><br><span class="line">MidEnd_42_TypeChecking</span><br><span class="line">MidEnd_43_LowerExpressions</span><br><span class="line">MidEnd_44_ConstantFolding</span><br><span class="line">MidEnd_45_TypeChecking</span><br><span class="line">MidEnd_46_RemoveComplexExpressions</span><br><span class="line">MidEnd_47_FixupChecksum</span><br><span class="line">MidEnd_48_SimplifyControlFlow</span><br><span class="line">MidEnd_49_RemoveAllUnusedDeclarations</span><br><span class="line">MidEnd_50_Evaluator</span><br><span class="line">MidEnd_51_VisitFunctor</span><br><span class="line">MidEnd_52_MidEndLast</span><br><span class="line">&gt; cat out.bin</span><br><span class="line">&#123;</span><br><span class="line"> &quot;tables&quot;: [</span><br><span class="line">  &#123;</span><br><span class="line">   &quot;preamble&quot;: &#123;</span><br><span class="line">    &quot;id&quot;: 33588198,</span><br><span class="line">    &quot;name&quot;: &quot;t1&quot;,</span><br><span class="line">    &quot;alias&quot;: &quot;t1&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;actionRefs&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">     &quot;id&quot;: 16792110</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">     &quot;id&quot;: 16800567,</span><br><span class="line">     &quot;annotations&quot;: [</span><br><span class="line">      &quot;@default_only()&quot;</span><br><span class="line">     ]</span><br><span class="line">    &#125;</span><br><span class="line">   ],</span><br><span class="line">   &quot;size&quot;: &quot;1024&quot;</span><br><span class="line">  &#125;</span><br><span class="line"> ],</span><br><span class="line"> &quot;actions&quot;: [</span><br><span class="line">  &#123;</span><br><span class="line">   &quot;preamble&quot;: &#123;</span><br><span class="line">    &quot;id&quot;: 16800567,</span><br><span class="line">    &quot;name&quot;: &quot;NoAction&quot;,</span><br><span class="line">    &quot;alias&quot;: &quot;NoAction&quot;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">   &quot;preamble&quot;: &#123;</span><br><span class="line">    &quot;id&quot;: 16792110,</span><br><span class="line">    &quot;name&quot;: &quot;a1&quot;,</span><br><span class="line">    &quot;alias&quot;: &quot;a1&quot;</span><br><span class="line">   &#125;,</span><br><span class="line">   &quot;params&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">     &quot;id&quot;: 1,</span><br><span class="line">     &quot;name&quot;: &quot;port&quot;,</span><br><span class="line">     &quot;bitwidth&quot;: 9</span><br><span class="line">    &#125;</span><br><span class="line">   ]</span><br><span class="line">  &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$</span><br></pre></td></tr></table></figure>
<h3 id="logging-功能样例"><a href="#logging-功能样例" class="headerlink" title="logging 功能样例"></a>logging 功能样例</h3><p>运行样例 bcast_router.p4app，虽然运行后有提示错误，但是不影响 logging 样例展示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ p4app run broadcast.p4app/</span><br><span class="line">Entering build directory.</span><br><span class="line">Extracting package.</span><br><span class="line">Reading package manifest.</span><br><span class="line">&gt; p4c-bm2-ss --p4v 16 &quot;bcast_router.p4&quot; -o &quot;bcast_router.p4.json&quot;</span><br><span class="line">&gt; python2 &quot;/scripts/mininet/multi_switch_mininet.py&quot; --log-dir &quot;/tmp/p4app_logs&quot; --manifest &quot;./p4app.json&quot; --target &quot;multiswitch&quot; --auto-control-plane --behavioral-exe &quot;simple_switch&quot; --json &quot;bcast_router.p4.json&quot;</span><br><span class="line">*** Error setting resource limits. Mininet&apos;s performance may be affected.</span><br><span class="line">*** Creating network</span><br><span class="line">*** Adding hosts:</span><br><span class="line">h1 h2 h3 </span><br><span class="line">*** Adding switches:</span><br><span class="line">s1 </span><br><span class="line">*** Adding links:</span><br><span class="line">(0ms delay) (0ms delay) (h1, s1) (0ms delay) (0ms delay) (h2, s1) (0ms delay) (0ms delay) (h3, s1) </span><br><span class="line">*** Configuring hosts</span><br><span class="line">h1 h2 h3 </span><br><span class="line">*** Starting controller</span><br><span class="line"></span><br><span class="line">*** Starting 1 switches</span><br><span class="line">s1 Starting P4 switch s1.</span><br><span class="line">simple_switch -i 1@s1-eth1 -i 2@s1-eth2 -i 3@s1-eth3 --pcap --thrift-port 9090 --nanolog ipc:///tmp/bm-0-log.ipc --device-id 0 bcast_router.p4.json --log-console</span><br><span class="line">P4 switch s1 has been started.</span><br><span class="line"></span><br><span class="line">-----------------------</span><br><span class="line">table_add ipv4_lpm broadcast 255.255.255.255/32 =&gt;</span><br><span class="line">table_add forward set_dmac 255.255.255.255 =&gt; ff:ff:ff:ff:ff:ff</span><br><span class="line">mc_mgrp_create 1</span><br><span class="line">mc_node_create 0 1 2 3</span><br><span class="line">mc_node_associate 1 0</span><br><span class="line">table_add ipv4_lpm broadcast 255.255.255.255/32 =&gt;</span><br><span class="line">table_add forward set_dmac 255.255.255.255 =&gt; ff:ff:ff:ff:ff:ff</span><br><span class="line">mc_mgrp_create 1</span><br><span class="line">mc_node_create 0 1 2 3</span><br><span class="line">mc_node_associate 1 0</span><br><span class="line">table_set_default send_frame _drop</span><br><span class="line">table_set_default forward _drop</span><br><span class="line">table_set_default ipv4_lpm _drop</span><br><span class="line">table_add send_frame rewrite_mac 2 =&gt; 00:aa:00:01:00:02</span><br><span class="line">table_add forward set_dmac 10.0.2.10 =&gt; 00:04:00:00:00:02</span><br><span class="line">table_add ipv4_lpm set_nhop 10.0.2.10/32 =&gt; 10.0.2.10 2</span><br><span class="line">table_add send_frame rewrite_mac 3 =&gt; 00:aa:00:01:00:03</span><br><span class="line">table_add forward set_dmac 10.0.3.10 =&gt; 00:04:00:00:00:03</span><br><span class="line">table_add ipv4_lpm set_nhop 10.0.3.10/32 =&gt; 10.0.3.10 3</span><br><span class="line">table_add send_frame rewrite_mac 1 =&gt; 00:aa:00:01:00:01</span><br><span class="line">table_add forward set_dmac 10.0.1.10 =&gt; 00:04:00:00:00:01</span><br><span class="line">table_add ipv4_lpm set_nhop 10.0.1.10/32 =&gt; 10.0.1.10 1</span><br><span class="line">Obtaining JSON from switch...</span><br><span class="line">Done</span><br><span class="line">Control utility for runtime P4 table manipulation</span><br><span class="line">RuntimeCmd: Adding entry to lpm match table ipv4_lpm</span><br><span class="line">match key:           LPM-ff:ff:ff:ff/32</span><br><span class="line">action:              broadcast</span><br><span class="line">runtime data:        </span><br><span class="line">Entry has been added with handle 0</span><br><span class="line">RuntimeCmd: Adding entry to exact match table forward</span><br><span class="line">match key:           EXACT-ff:ff:ff:ff</span><br><span class="line">action:              set_dmac</span><br><span class="line">runtime data:        ff:ff:ff:ff:ff:ff</span><br><span class="line">Entry has been added with handle 0</span><br><span class="line">RuntimeCmd: Creating multicast group 1</span><br><span class="line">RuntimeCmd: Creating node with rid 0 , port map 1110 and lag map </span><br><span class="line">node was created with handle 0</span><br><span class="line">RuntimeCmd: Associating node 0 to multicast group 1</span><br><span class="line">RuntimeCmd: Adding entry to lpm match table ipv4_lpm</span><br><span class="line">match key:           LPM-ff:ff:ff:ff/32</span><br><span class="line">action:              broadcast</span><br><span class="line">runtime data:        </span><br><span class="line">Invalid table operation (DUPLICATE_ENTRY)</span><br><span class="line">RuntimeCmd: Adding entry to exact match table forward</span><br><span class="line">match key:           EXACT-ff:ff:ff:ff</span><br><span class="line">action:              set_dmac</span><br><span class="line">runtime data:        ff:ff:ff:ff:ff:ff</span><br><span class="line">Invalid table operation (DUPLICATE_ENTRY)</span><br><span class="line">RuntimeCmd: Creating multicast group 1</span><br><span class="line">RuntimeCmd: Creating node with rid 0 , port map 1110 and lag map </span><br><span class="line">node was created with handle 1</span><br><span class="line">RuntimeCmd: Associating node 0 to multicast group 1</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/local/bin/simple_switch_CLI&quot;, line 31, in &lt;module&gt;</span><br><span class="line">    sswitch_CLI.main()</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/dist-packages/sswitch_CLI.py&quot;, line 93, in main</span><br><span class="line">    SimpleSwitchAPI(args.pre, standard_client, mc_client, sswitch_client).cmdloop()</span><br><span class="line">  File &quot;/usr/lib/python2.7/cmd.py&quot;, line 142, in cmdloop</span><br><span class="line">    stop = self.onecmd(line)</span><br><span class="line">  File &quot;/usr/lib/python2.7/cmd.py&quot;, line 221, in onecmd</span><br><span class="line">    return func(arg)</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/dist-packages/runtime_CLI.py&quot;, line 585, in handle</span><br><span class="line">    return f(*args, **kwargs)</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/dist-packages/runtime_CLI.py&quot;, line 1543, in do_mc_node_associate</span><br><span class="line">    self.mc_client.bm_mc_node_associate(0, mgrp, l1_hdl)</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/dist-packages/bm_runtime/simple_pre_lag/SimplePreLAG.py&quot;, line 222, in bm_mc_node_associate</span><br><span class="line">    self.recv_bm_mc_node_associate()</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/dist-packages/bm_runtime/simple_pre_lag/SimplePreLAG.py&quot;, line 246, in recv_bm_mc_node_associate</span><br><span class="line">    raise result.ouch</span><br><span class="line">bm_runtime.simple_pre_lag.ttypes.InvalidMcOperation: InvalidMcOperation(code=4)</span><br><span class="line">**********</span><br><span class="line">Network configuration for: h1</span><br><span class="line">Default interface: h1-eth0      10.0.0.1        00:04:00:00:00:01</span><br><span class="line">**********</span><br><span class="line">**********</span><br><span class="line">Network configuration for: h2</span><br><span class="line">Default interface: h2-eth0      10.0.0.2        00:04:00:00:00:02</span><br><span class="line">**********</span><br><span class="line">**********</span><br><span class="line">Network configuration for: h3</span><br><span class="line">Default interface: h3-eth0      10.0.0.3        00:04:00:00:00:03</span><br><span class="line">**********</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h1 ./bcast_listen.py</span><br><span class="line">h2 ./bcast_listen.py</span><br><span class="line">h3 ./bcast_send.py</span><br><span class="line">(None, &apos;&apos;)</span><br><span class="line">(None, &quot;received &apos;hello everyone&apos; from (&apos;10.0.3.10&apos;, 60592)\n&quot;)</span><br><span class="line">(None, &quot;received &apos;hello everyone&apos; from (&apos;10.0.3.10&apos;, 60592)\n&quot;)</span><br><span class="line">*** Stopping 0 controllers</span><br><span class="line"></span><br><span class="line">*** Stopping 3 links</span><br><span class="line">...</span><br><span class="line">*** Stopping 1 switches</span><br><span class="line">s1 </span><br><span class="line">*** Stopping 3 hosts</span><br><span class="line">h1 h2 h3 </span><br><span class="line">*** Done</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ </span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ ls /tmp/p4app_logs/</span><br><span class="line">h1.stdout     h2.stdout     h3.stdout     p4s.s1.log    s1-eth1.pcap  s1-eth2.pcap  s1-eth3.pcap  </span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$ cat /tmp/p4app_logs/p4s.s1.log   </span><br><span class="line">Calling target program-options parser</span><br><span class="line">[09:22:09.326] [bmv2] [D] [thread 83] Set default entry for table &apos;ipv4_lpm&apos;: NoAction - </span><br><span class="line">[09:22:09.326] [bmv2] [D] [thread 83] Set default entry for table &apos;forward&apos;: NoAction - </span><br><span class="line">[09:22:09.326] [bmv2] [D] [thread 83] Set default entry for table &apos;send_frame&apos;: NoAction - </span><br><span class="line">Adding interface s1-eth1 as port 1</span><br><span class="line">[09:22:09.326] [bmv2] [D] [thread 83] Adding interface s1-eth1 as port 1</span><br><span class="line">Adding interface s1-eth2 as port 2</span><br><span class="line">[09:22:09.355] [bmv2] [D] [thread 83] Adding interface s1-eth2 as port 2</span><br><span class="line">Adding interface s1-eth3 as port 3</span><br><span class="line">[09:22:09.395] [bmv2] [D] [thread 83] Adding interface s1-eth3 as port 3</span><br><span class="line">Thrift server was started</span><br><span class="line">[09:22:10.462] [bmv2] [T] [thread 97] bm_get_config</span><br><span class="line">[09:22:10.465] [bmv2] [T] [thread 97] bm_table_add_entry</span><br><span class="line">[09:22:10.465] [bmv2] [D] [thread 97] Entry 0 added to table &apos;ipv4_lpm&apos;</span><br><span class="line">[09:22:10.465] [bmv2] [D] [thread 97] Dumping entry 0</span><br><span class="line">Match key:</span><br><span class="line">* ipv4.dstAddr        : LPM       ffffffff/32</span><br><span class="line">Action entry: broadcast - </span><br><span class="line"></span><br><span class="line">[09:22:10.466] [bmv2] [T] [thread 97] bm_table_add_entry</span><br><span class="line">[09:22:10.466] [bmv2] [D] [thread 97] Entry 0 added to table &apos;forward&apos;</span><br><span class="line">[09:22:10.466] [bmv2] [D] [thread 97] Dumping entry 0</span><br><span class="line">Match key:</span><br><span class="line">* ingress_metadata.nhop_ipv4: EXACT     ffffffff</span><br><span class="line">Action entry: set_dmac - ffffffffffff,</span><br><span class="line"></span><br><span class="line">[09:22:10.466] [bmv2] [T] [thread 97] bm_mc_mgrp_create</span><br><span class="line">[09:22:10.466] [bmv2] [D] [thread 97] mgrp node created for mgid 1</span><br><span class="line">[09:22:10.466] [bmv2] [T] [thread 97] bm_mc_node_create</span><br><span class="line">[09:22:10.466] [bmv2] [D] [thread 97] node created for rid 0</span><br><span class="line">[09:22:10.466] [bmv2] [T] [thread 97] bm_mc_node_associate</span><br><span class="line">[09:22:10.466] [bmv2] [D] [thread 97] node associated with mgid 1</span><br><span class="line">[09:22:10.467] [bmv2] [T] [thread 97] bm_table_add_entry</span><br><span class="line">[09:22:10.467] [bmv2] [E] [thread 97] Error when trying to add entry to table &apos;ipv4_lpm&apos;</span><br><span class="line">[09:22:10.487] [bmv2] [T] [thread 97] bm_table_add_entry</span><br><span class="line">[09:22:10.487] [bmv2] [E] [thread 97] Error when trying to add entry to table &apos;forward&apos;</span><br><span class="line">[09:22:10.488] [bmv2] [T] [thread 97] bm_mc_mgrp_create</span><br><span class="line">[09:22:10.488] [bmv2] [D] [thread 97] mgrp node created for mgid 1</span><br><span class="line">[09:22:10.488] [bmv2] [T] [thread 97] bm_mc_node_create</span><br><span class="line">[09:22:10.488] [bmv2] [D] [thread 97] node created for rid 0</span><br><span class="line">[09:22:10.488] [bmv2] [T] [thread 97] bm_mc_node_associate</span><br><span class="line">[09:22:10.488] [bmv2] [E] [thread 97] node associate failed, node is already associated</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Processing packet received on port 3</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Parser &apos;parser&apos;: start</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Extracting header &apos;ethernet&apos;</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Parser state &apos;start&apos;: key is 0800</span><br><span class="line">[09:22:10.819] [bmv2] [T] [thread 89] [0.0] [cxt 0] Bytes parsed: 14</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Extracting header &apos;ipv4&apos;</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Parser state &apos;parse_ipv4&apos; has no switch, going to default next state</span><br><span class="line">[09:22:10.819] [bmv2] [T] [thread 89] [0.0] [cxt 0] Bytes parsed: 34</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Parser &apos;parser&apos;: end</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Pipeline &apos;ingress&apos;: start</span><br><span class="line">[09:22:10.819] [bmv2] [T] [thread 89] [0.0] [cxt 0] bcast_router.p4(76) Condition &quot;hdr.ipv4.isValid()&quot; is true</span><br><span class="line">[09:22:10.819] [bmv2] [T] [thread 89] [0.0] [cxt 0] Applying table &apos;ipv4_lpm&apos;</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Looking up key:</span><br><span class="line">* ipv4.dstAddr        : ffffffff</span><br><span class="line"></span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Table &apos;ipv4_lpm&apos;: hit with handle 0</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Dumping entry 0</span><br><span class="line">Match key:</span><br><span class="line">* ipv4.dstAddr        : LPM       ffffffff/32</span><br><span class="line">Action entry: broadcast - </span><br><span class="line"></span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Action entry is broadcast - </span><br><span class="line">[09:22:10.819] [bmv2] [T] [thread 89] [0.0] [cxt 0] bcast_router.p4(42) Executing action broadcast</span><br><span class="line">[09:22:10.819] [bmv2] [T] [thread 89] [0.0] [cxt 0] Applying table &apos;forward&apos;</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Looking up key:</span><br><span class="line">* ingress_metadata.nhop_ipv4: ffffffff</span><br><span class="line"></span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Table &apos;forward&apos;: hit with handle 0</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Dumping entry 0</span><br><span class="line">Match key:</span><br><span class="line">* ingress_metadata.nhop_ipv4: EXACT     ffffffff</span><br><span class="line">Action entry: set_dmac - ffffffffffff,</span><br><span class="line"></span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Action entry is set_dmac - ffffffffffff,</span><br><span class="line">[09:22:10.819] [bmv2] [T] [thread 89] [0.0] [cxt 0] bcast_router.p4(47) Executing action set_dmac</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Pipeline &apos;ingress&apos;: end</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Multicast requested for packet</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] number of packets replicated : 3</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Replicating packet on port 1</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Replicating packet on port 2</span><br><span class="line">[09:22:10.819] [bmv2] [D] [thread 89] [0.0] [cxt 0] Replicating packet on port 3</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Pipeline &apos;egress&apos;: start</span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 91] [0.1] [cxt 0] bcast_router.p4(27) Condition &quot;hdr.ipv4.isValid()&quot; is true</span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 91] [0.1] [cxt 0] Applying table &apos;send_frame&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Looking up key:</span><br><span class="line">* standard_metadata.egress_port: 0001</span><br><span class="line"></span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Table &apos;send_frame&apos;: miss</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Action entry is NoAction - </span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 91] [0.1] [cxt 0] /usr/local/share/p4c/p4include/core.p4(55) Executing action NoAction</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Pipeline &apos;egress&apos;: end</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Deparser &apos;deparser&apos;: start</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Updating checksum &apos;cksum&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Deparsing header &apos;ethernet&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Deparsing header &apos;ipv4&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 91] [0.1] [cxt 0] Deparser &apos;deparser&apos;: end</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Pipeline &apos;egress&apos;: start</span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 92] [0.2] [cxt 0] bcast_router.p4(27) Condition &quot;hdr.ipv4.isValid()&quot; is true</span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 92] [0.2] [cxt 0] Applying table &apos;send_frame&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Looking up key:</span><br><span class="line">* standard_metadata.egress_port: 0002</span><br><span class="line"></span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Table &apos;send_frame&apos;: miss</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Action entry is NoAction - </span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 92] [0.2] [cxt 0] /usr/local/share/p4c/p4include/core.p4(55) Executing action NoAction</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Pipeline &apos;egress&apos;: end</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Deparser &apos;deparser&apos;: start</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Updating checksum &apos;cksum&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Deparsing header &apos;ethernet&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Deparsing header &apos;ipv4&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 92] [0.2] [cxt 0] Deparser &apos;deparser&apos;: end</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Pipeline &apos;egress&apos;: start</span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 93] [0.3] [cxt 0] bcast_router.p4(27) Condition &quot;hdr.ipv4.isValid()&quot; is true</span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 93] [0.3] [cxt 0] Applying table &apos;send_frame&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Looking up key:</span><br><span class="line">* standard_metadata.egress_port: 0003</span><br><span class="line"></span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Table &apos;send_frame&apos;: miss</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Action entry is NoAction - </span><br><span class="line">[09:22:10.820] [bmv2] [T] [thread 93] [0.3] [cxt 0] /usr/local/share/p4c/p4include/core.p4(55) Executing action NoAction</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Pipeline &apos;egress&apos;: end</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Deparser &apos;deparser&apos;: start</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Updating checksum &apos;cksum&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Deparsing header &apos;ethernet&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Deparsing header &apos;ipv4&apos;</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 93] [0.3] [cxt 0] Deparser &apos;deparser&apos;: end</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 94] [0.1] [cxt 0] Transmitting packet of size 56 out of port 1</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 94] [0.2] [cxt 0] Transmitting packet of size 56 out of port 2</span><br><span class="line">[09:22:10.820] [bmv2] [D] [thread 94] [0.3] [cxt 0] Transmitting packet of size 56 out of port 3</span><br><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app/examples$</span><br></pre></td></tr></table></figure>
<h3 id="docker-镜像大小"><a href="#docker-镜像大小" class="headerlink" title="docker 镜像大小"></a>docker 镜像大小</h3><p>当前版本 docker 镜像只有 908MB，已集成 tshark / scapy 等工具，不算大。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sunyongfeng@openswitch-OptiPlex-380:~/workshop/p4app$ docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">p4lang/p4app          latest              07024040be0e        6 hours ago         908MB</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/10/networks/p4/repo_p4app/" data-id="cjz95gt6400miw5r9m5nlmnk2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/p4/">p4</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/05/11/networks/nat/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          NAT 知识汇总
        
      </div>
    </a>
  
  
    <a href="/2017/05/09/networks/quagga/quickstart/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Quagga 入门</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/administrator/">administrator</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/dokuwiki/">dokuwiki</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/misc/">misc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/networks/">networks</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/newTech/">newTech</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/p4/">p4</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programmer/">programmer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools-administrator/">tools, administrator</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/yocto/">yocto</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/思考/">思考</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARP/">ARP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CPU/">CPU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Excel/">Excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GDB/">GDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/L2/">L2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MTU/">MTU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NOS/">NOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SecureCRT/">SecureCRT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/administrator/">administrator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app/">app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apt/">apt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm/">arm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arp/">arp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cable/">cable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clock/">clock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compile/">compile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/configure/">configure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coredump/">coredump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dataplane/">dataplane</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deb/">deb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debian/">debian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/discourse/">discourse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dokuwiki/">dokuwiki</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dos/">dos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elementary/">elementary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fcitx/">fcitx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc/">gcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gnome-terminal/">gnome-terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grub/">grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/int/">int</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kconfig/">kconfig</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lib/">lib</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libteam/">libteam</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile/">makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mirror/">mirror</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/moinmoin/">moinmoin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nat/">nat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/networks/">networks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openswitch/">openswitch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/p4/">p4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/packet/">packet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paper/">paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perf/">perf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/">pip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ppp/">ppp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pppoe-networks/">pppoe networks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/profiling/">profiling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programmer/">programmer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/quagga/">quagga</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redhat/">redhat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpm/">rpm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scp/">scp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serialport/">serialport</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server/">server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/software/">software</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sshd/">sshd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/telnet/">telnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/terminal/">terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time/">time</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tuntap/">tuntap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vagrant/">vagrant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/veth/">veth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualBox/">virtualBox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vlc/">vlc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vnc/">vnc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wiki/">wiki</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wine/">wine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wireshark/">wireshark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wps/">wps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xterm/">xterm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yocto/">yocto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/串口/">串口</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/交叉编译/">交叉编译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/交换机/">交换机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内存管理/">内存管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/外面的世界/">外面的世界</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/字符流操作/">字符流操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/思考/">思考</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件共享/">文件共享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件系统/">文件系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/新技术点/">新技术点</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/版本控制/">版本控制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/磁盘管理/">磁盘管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络测试/">网络测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/虚拟机/">虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/调试/">调试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/路由协议/">路由协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/进程/">进程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/远程登录/">远程登录</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARP/" style="font-size: 10px;">ARP</a> <a href="/tags/CPU/" style="font-size: 10px;">CPU</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/GDB/" style="font-size: 10px;">GDB</a> <a href="/tags/L2/" style="font-size: 10px;">L2</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/MTU/" style="font-size: 10px;">MTU</a> <a href="/tags/NOS/" style="font-size: 10px;">NOS</a> <a href="/tags/SecureCRT/" style="font-size: 11.82px;">SecureCRT</a> <a href="/tags/administrator/" style="font-size: 17.27px;">administrator</a> <a href="/tags/app/" style="font-size: 10px;">app</a> <a href="/tags/apt/" style="font-size: 10.91px;">apt</a> <a href="/tags/arm/" style="font-size: 10px;">arm</a> <a href="/tags/arp/" style="font-size: 10px;">arp</a> <a href="/tags/c/" style="font-size: 16.36px;">c</a> <a href="/tags/cable/" style="font-size: 10px;">cable</a> <a href="/tags/centos/" style="font-size: 10px;">centos</a> <a href="/tags/clock/" style="font-size: 10px;">clock</a> <a href="/tags/compile/" style="font-size: 10.91px;">compile</a> <a href="/tags/configure/" style="font-size: 10px;">configure</a> <a href="/tags/coredump/" style="font-size: 10px;">coredump</a> <a href="/tags/dataplane/" style="font-size: 10px;">dataplane</a> <a href="/tags/deb/" style="font-size: 13.64px;">deb</a> <a href="/tags/debian/" style="font-size: 10.91px;">debian</a> <a href="/tags/discourse/" style="font-size: 10px;">discourse</a> <a href="/tags/docker/" style="font-size: 10.91px;">docker</a> <a href="/tags/dokuwiki/" style="font-size: 12.73px;">dokuwiki</a> <a href="/tags/dos/" style="font-size: 10px;">dos</a> <a href="/tags/elementary/" style="font-size: 10px;">elementary</a> <a href="/tags/fcitx/" style="font-size: 10px;">fcitx</a> <a href="/tags/gcc/" style="font-size: 10px;">gcc</a> <a href="/tags/git/" style="font-size: 15.45px;">git</a> <a href="/tags/gnome-terminal/" style="font-size: 10px;">gnome-terminal</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/int/" style="font-size: 10.91px;">int</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/kconfig/" style="font-size: 10px;">kconfig</a> <a href="/tags/kernel/" style="font-size: 11.82px;">kernel</a> <a href="/tags/lib/" style="font-size: 10px;">lib</a> <a href="/tags/libteam/" style="font-size: 10px;">libteam</a> <a href="/tags/linux/" style="font-size: 13.64px;">linux</a> <a href="/tags/makefile/" style="font-size: 10px;">makefile</a> <a href="/tags/mirror/" style="font-size: 10px;">mirror</a> <a href="/tags/misc/" style="font-size: 11.82px;">misc</a> <a href="/tags/moinmoin/" style="font-size: 10px;">moinmoin</a> <a href="/tags/nat/" style="font-size: 10px;">nat</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/networks/" style="font-size: 14.55px;">networks</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/openswitch/" style="font-size: 10.91px;">openswitch</a> <a href="/tags/p4/" style="font-size: 14.55px;">p4</a> <a href="/tags/packet/" style="font-size: 10.91px;">packet</a> <a href="/tags/paper/" style="font-size: 10px;">paper</a> <a href="/tags/perf/" style="font-size: 10px;">perf</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/ppp/" style="font-size: 10px;">ppp</a> <a href="/tags/pppoe-networks/" style="font-size: 10px;">pppoe networks</a> <a href="/tags/profiling/" style="font-size: 10px;">profiling</a> <a href="/tags/programmer/" style="font-size: 10px;">programmer</a> <a href="/tags/python/" style="font-size: 13.64px;">python</a> <a href="/tags/quagga/" style="font-size: 10px;">quagga</a> <a href="/tags/redhat/" style="font-size: 10px;">redhat</a> <a href="/tags/redis/" style="font-size: 10.91px;">redis</a> <a href="/tags/rpc/" style="font-size: 10px;">rpc</a> <a href="/tags/rpm/" style="font-size: 10px;">rpm</a> <a href="/tags/scp/" style="font-size: 10px;">scp</a> <a href="/tags/serialport/" style="font-size: 10.91px;">serialport</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/sshd/" style="font-size: 10px;">sshd</a> <a href="/tags/svn/" style="font-size: 10.91px;">svn</a> <a href="/tags/telnet/" style="font-size: 10px;">telnet</a> <a href="/tags/terminal/" style="font-size: 10px;">terminal</a> <a href="/tags/time/" style="font-size: 10px;">time</a> <a href="/tags/tuntap/" style="font-size: 10px;">tuntap</a> <a href="/tags/ubuntu/" style="font-size: 19.09px;">ubuntu</a> <a href="/tags/vagrant/" style="font-size: 10px;">vagrant</a> <a href="/tags/veth/" style="font-size: 10px;">veth</a> <a href="/tags/vim/" style="font-size: 11.82px;">vim</a> <a href="/tags/virtualBox/" style="font-size: 10px;">virtualBox</a> <a href="/tags/vlc/" style="font-size: 10px;">vlc</a> <a href="/tags/vnc/" style="font-size: 10px;">vnc</a> <a href="/tags/wiki/" style="font-size: 10px;">wiki</a> <a href="/tags/windows/" style="font-size: 12.73px;">windows</a> <a href="/tags/wine/" style="font-size: 10px;">wine</a> <a href="/tags/wireshark/" style="font-size: 10px;">wireshark</a> <a href="/tags/wps/" style="font-size: 10px;">wps</a> <a href="/tags/xterm/" style="font-size: 10px;">xterm</a> <a href="/tags/yocto/" style="font-size: 10.91px;">yocto</a> <a href="/tags/串口/" style="font-size: 10.91px;">串口</a> <a href="/tags/交叉编译/" style="font-size: 10px;">交叉编译</a> <a href="/tags/交换机/" style="font-size: 10px;">交换机</a> <a href="/tags/内存管理/" style="font-size: 10px;">内存管理</a> <a href="/tags/外面的世界/" style="font-size: 10px;">外面的世界</a> <a href="/tags/字符流操作/" style="font-size: 10.91px;">字符流操作</a> <a href="/tags/思考/" style="font-size: 10.91px;">思考</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/文件共享/" style="font-size: 10px;">文件共享</a> <a href="/tags/文件系统/" style="font-size: 18.18px;">文件系统</a> <a href="/tags/新技术点/" style="font-size: 10px;">新技术点</a> <a href="/tags/版本控制/" style="font-size: 15.45px;">版本控制</a> <a href="/tags/磁盘管理/" style="font-size: 10px;">磁盘管理</a> <a href="/tags/网络测试/" style="font-size: 12.73px;">网络测试</a> <a href="/tags/虚拟机/" style="font-size: 10px;">虚拟机</a> <a href="/tags/调试/" style="font-size: 10px;">调试</a> <a href="/tags/路由协议/" style="font-size: 10px;">路由协议</a> <a href="/tags/进程/" style="font-size: 10px;">进程</a> <a href="/tags/远程登录/" style="font-size: 12.73px;">远程登录</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/23/misc/screen_too_bright/">屏幕太“亮”看不清灰色部分</a>
          </li>
        
          <li>
            <a href="/2019/03/25/linux/elementaryos/">elementary OS 使用记录</a>
          </li>
        
          <li>
            <a href="/2019/01/31/tools/git_cmd/">一些常见的 git 命令备忘</a>
          </li>
        
          <li>
            <a href="/2019/01/24/networks/rpc.rpc_poll.rpc_streaming/">图解 rpc rpc_poll 和 rpc_streaming 的差异</a>
          </li>
        
          <li>
            <a href="/2018/11/01/programmer/tools/kconfig-frontends/">kconfig-frontends 简介</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>